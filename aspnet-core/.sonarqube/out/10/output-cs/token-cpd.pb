Ñ:
ÖD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\UserProfile\UserProfileAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
UserProfile  +
{ 
[ 
	Authorize 
] 
public 

class !
UserProfileAppService &
(& '
IRepository 
< 
AccountUser 
,  
Guid! %
>% &!
userAccountRepository' <
,< =
ICurrentUser 
currentUser  
,  ! 
IHttpContextAccessor" 6
httpContextAccessor7 J
)J K
:L M
ApplicationServiceN `
,` a"
IUserProflieAppServiceb x
{ 
private 
readonly 
IRepository $
<$ %
AccountUser% 0
,0 1
Guid2 6
>6 7"
_userAccountRepository8 N
=O P!
userAccountRepositoryQ f
;f g
private 
readonly 
ICurrentUser %
_currentUser& 2
=3 4
currentUser5 @
;@ A
private 
readonly  
IHttpContextAccessor - 
_httpContextAccessor. B
=C D
httpContextAccessorE X
;X Y
public 
async 
Task 
< 
GeneralResponse )
>) *
UpdateAsync+ 6
(6 7
[7 8
FromForm8 @
]@ A
UpdateAccountDtoB R
?R S
dtoT W
)W X
{ 	
if 
( 
dto 
is 
null 
) 
return #
new$ '
GeneralResponse( 7
(7 8
false8 =
,= >
$str? N
)N O
;O P
Console   
.   
	WriteLine   
(   
$"    
$str    3
{  3 4
_currentUser  4 @
}  @ A
"  A B
)  B C
;  C D
var"" 
userId"" 
="" 
_currentUser"" %
.""% &
Id""& (
;""( )
if## 
(## 
userId## 
==## 
null## 
)## 
return##  &
new##' *
GeneralResponse##+ :
(##: ;
false##; @
,##@ A
$str##B V
)##V W
;##W X
var%% 
user%% 
=%% 
await%% "
_userAccountRepository%% 3
.%%3 4
	FindAsync%%4 =
(%%= >
userId%%> D
.%%D E
Value%%E J
)%%J K
;%%K L
if&& 
(&& 
user&& 
==&& 
null&& 
)&& 
return&& $
new&&% (
GeneralResponse&&) 8
(&&8 9
false&&9 >
,&&> ?
$str&&@ P
)&&P Q
;&&Q R
user(( 
.(( 
UserName(( 
=(( 
dto(( 
.((  
UserName((  (
;((( )
user)) 
.)) 
Phone)) 
=)) 
dto)) 
.)) 
PhoneNumber)) (
;))( )
user** 
.** 
WhatsApp** 
=** 
dto** 
.**  
WhatsApp**  (
;**( )
user++ 
.++ 
Country++ 
=++ 
dto++ 
.++ 
Country++ &
;++& '
user,, 
.,, 
CompanyName,, 
=,, 
dto,, "
.,," #
CompanyName,,# .
;,,. /
user-- 
.-- 
CompanyEmail-- 
=-- 
dto--  #
.--# $
CompanyMail--$ /
;--/ 0
user.. 
... 

Department.. 
=.. 
dto.. !
...! "

Department.." ,
;.., -
user// 
.// 
JobPosition// 
=// 
dto// "
.//" #
JobPosition//# .
;//. /
var11 
profilePicture11 
=11  
dto11! $
.11$ %
ProfilePicture11% 3
;113 4
if22 
(22 
profilePicture22 
!=22 !
null22" &
)22& '
{33 
var44 
fileName44 
=44 
Path44 #
.44# $
GetFileName44$ /
(44/ 0
profilePicture440 >
.44> ?
FileName44? G
)44G H
;44H I
var55 
uniqueFileName55 "
=55# $
$"55% '
{55' (
Guid55( ,
.55, -
NewGuid55- 4
(554 5
)555 6
}556 7
$str557 8
{558 9
fileName559 A
}55A B
"55B C
;55C D
var66 
uploadsPath66 
=66  !
Path66" &
.66& '
Combine66' .
(66. /
	Directory66/ 8
.668 9
GetCurrentDirectory669 L
(66L M
)66M N
,66N O
$str66P Y
,66Y Z
$str66[ d
)66d e
;66e f
if88 
(88 
!88 
	Directory88 
.88 
Exists88 %
(88% &
uploadsPath88& 1
)881 2
)882 3
	Directory99 
.99 
CreateDirectory99 -
(99- .
uploadsPath99. 9
)999 :
;99: ;
var;; 
filePath;; 
=;; 
Path;; #
.;;# $
Combine;;$ +
(;;+ ,
uploadsPath;;, 7
,;;7 8
uniqueFileName;;9 G
);;G H
;;;H I
using<< 
(<< 
var<< 
stream<< !
=<<" #
new<<$ '

FileStream<<( 2
(<<2 3
filePath<<3 ;
,<<; <
FileMode<<= E
.<<E F
Create<<F L
)<<L M
)<<M N
{== 
await>> 
profilePicture>> (
.>>( )
CopyToAsync>>) 4
(>>4 5
stream>>5 ;
)>>; <
;>>< =
}?? 
varAA 
requestAA 
=AA  
_httpContextAccessorAA 2
.AA2 3
HttpContextAA3 >
!AA> ?
.AA? @
RequestAA@ G
;AAG H
varBB 
baseUrlBB 
=BB 
$"BB  
{BB  !
requestBB! (
.BB( )
SchemeBB) /
}BB/ 0
$strBB0 3
{BB3 4
requestBB4 ;
.BB; <
HostBB< @
}BB@ A
"BBA B
;BBB C
userCC 
.CC 
ProfilePictureUrlCC &
=CC' (
$"CC) +
{CC+ ,
baseUrlCC, 3
}CC3 4
$strCC4 =
{CC= >
uniqueFileNameCC> L
}CCL M
"CCM N
;CCN O
}DD 
awaitFF "
_userAccountRepositoryFF (
.FF( )
UpdateAsyncFF) 4
(FF4 5
userFF5 9
)FF9 :
;FF: ;
returnGG 
newGG 
GeneralResponseGG &
(GG& '
trueGG' +
,GG+ ,
$strGG- K
,GGK L
userGGM Q
)GGQ R
;GGR S
}HH 	
}KK 
}LL ¬
ÜD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\UserProfile\IUserProflieAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
UserProfile  +
{ 
public 

	interface "
IUserProflieAppService +
:, -
IApplicationService. A
{ 
Task 
< 
GeneralResponse 
> 
UpdateAsync )
() *
[* +
FromForm+ 3
]3 4
UpdateAccountDto5 E
?E F
userG K
)K L
;L M
} 
} Íƒ
ÖD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\UserAccount\UserAccountAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
UserAccount  +
{ 
public 

class !
UserAccountAppService &
(& '
IOptions 
< 

JwtSection 
> 
config #
,# $ 
IHttpContextAccessor 
httpContextAccessor 0
,0 1
IRepository 
< 
AccountUser 
,  
Guid! %
>% &!
userAccountRepository' <
,< =
IRepository   
<   
RefreshTokenInfo   $
,  $ %
Guid  & *
>  * +&
userRefreshTokenRepository  , F
)!! 	
:"" 	
ApplicationService""
 
,"" "
IUserAccountAppService"" 4
{$$ 
private%% 
readonly%%  
IHttpContextAccessor%% - 
_httpContextAccessor%%. B
=%%C D
httpContextAccessor%%E X
;%%X Y
public&& 
async&& 
Task&& 
<&& 
GeneralResponse&& )
>&&) *
RegisterAsync&&+ 8
(&&8 9
[&&9 :
FromForm&&: B
]&&B C"
CreateUpdateAccountDto&&D Z
?&&Z [
user&&\ `
)&&a b
{'' 	
var(( 
httpContext(( 
=(( 
httpContextAccessor(( 1
.((1 2
HttpContext((2 =
;((= >
if)) 
()) 
user)) 
is)) 
null)) 
))) 
return)) $
new))% (
GeneralResponse))) 8
())8 9
false))9 >
,))> ?
$str))@ P
)))P Q
;))Q R
var++ 
	checkUser++ 
=++ 
await++ !
FindUserByEmail++" 1
(++1 2
user++2 6
.++6 7
Email++7 <
!++< =
)++= >
;++> ?
if,, 
(,, 
	checkUser,, 
!=,, 
null,, !
),,! "
return,,# )
new,,* -
GeneralResponse,,. =
(,,= >
false,,> C
,,,C D
$str,,E ^
),,^ _
;,,_ `
var00 
userAccount00 
=00 
new00 !
AccountUser00" -
{11 
Type22 
=22 
user22 
.22 
UserType22 $
,22$ %
Email33 
=33 
user33 
.33 
Email33 !
,33! "
UserName44 
=44 
user44 
.44  
UserName44  (
,44( )
CompanyEmail55 
=55 
user55 #
.55# $
CompanyMail55$ /
,55/ 0
CompanyName66 
=66 
user66 "
.66" #
CompanyName66# .
,66. /

Department77 
=77 
user77 !
.77! "

Department77" ,
,77, -
JobPosition88 
=88 
user88 "
.88" #
JobPosition88# .
,88. /
Phone99 
=99 
user99 
.99 
PhoneNumber99 (
,99( )
WhatsApp:: 
=:: 
user:: 
.::  
WhatsApp::  (
,::( )
Country;; 
=;; 
user;; 
.;; 
Country;; &
,;;& '
Password<< 
=<< 
BCrypt<< !
.<<! "
Net<<" %
.<<% &
BCrypt<<& ,
.<<, -
HashPassword<<- 9
(<<9 :
user<<: >
.<<> ?
Password<<? G
)<<G H
,<<H I
}== 
;== 
var?? 
profilePicture?? 
=??  
user??! %
.??% &
ProfilePicture??& 4
;??4 5
ifAA 
(AA 
profilePictureAA 
!=AA !
nullAA" &
)AA& '
{BB 
varCC 
fileNameCC 
=CC 
PathCC #
.CC# $
GetFileNameCC$ /
(CC/ 0
profilePictureCC0 >
.CC> ?
FileNameCC? G
)CCG H
;CCH I
varDD 
uniqueFileNameDD "
=DD# $
$"DD% '
{DD' (
GuidDD( ,
.DD, -
NewGuidDD- 4
(DD4 5
)DD5 6
}DD6 7
$strDD7 8
{DD8 9
fileNameDD9 A
}DDA B
"DDB C
;DDC D
varGG 
uploadsPathGG 
=GG  !
PathGG" &
.GG& '
CombineGG' .
(GG. /
	DirectoryGG/ 8
.GG8 9
GetCurrentDirectoryGG9 L
(GGL M
)GGM N
,GGN O
$strGGP Y
,GGY Z
$strGG[ d
)GGd e
;GGe f
ifII 
(II 
!II 
	DirectoryII 
.II 
ExistsII %
(II% &
uploadsPathII& 1
)II1 2
)II2 3
{JJ 
	DirectoryKK 
.KK 
CreateDirectoryKK -
(KK- .
uploadsPathKK. 9
)KK9 :
;KK: ;
}LL 
varOO 
filePathOO 
=OO 
PathOO #
.OO# $
CombineOO$ +
(OO+ ,
uploadsPathOO, 7
,OO7 8
uniqueFileNameOO9 G
)OOG H
;OOH I
awaitPP 
usingPP 
(PP 
varPP  
streamPP! '
=PP( )
newPP* -

FileStreamPP. 8
(PP8 9
filePathPP9 A
,PPA B
FileModePPC K
.PPK L
CreatePPL R
)PPR S
)PPS T
{QQ 
awaitRR 
profilePictureRR (
.RR( )
CopyToAsyncRR) 4
(RR4 5
streamRR5 ;
)RR; <
;RR< =
}SS 
varVV 
requestVV 
=VV 
httpContextVV )
.VV) *
RequestVV* 1
;VV1 2
varWW 
baseUrlWW 
=WW 
$"WW  
{WW  !
requestWW! (
.WW( )
SchemeWW) /
}WW/ 0
$strWW0 3
{WW3 4
requestWW4 ;
.WW; <
HostWW< @
}WW@ A
"WWA B
;WWB C
varXX 
relativePathXX  
=XX! "
$"XX# %
$strXX% .
{XX. /
uniqueFileNameXX/ =
}XX= >
"XX> ?
;XX? @
varYY 
fullUrlYY 
=YY 
$"YY  
{YY  !
baseUrlYY! (
}YY( )
{YY) *
relativePathYY* 6
}YY6 7
"YY7 8
;YY8 9
userAccount\\ 
.\\ 
ProfilePictureUrl\\ -
=\\. /
fullUrl\\0 7
;\\7 8
}]] 
await__ !
userAccountRepository__ '
.__' (
InsertAsync__( 3
(__3 4
userAccount__4 ?
)__? @
;__@ A
return`` 
new`` 
GeneralResponse`` &
(``& '
true``' +
,``+ ,
$str``, J
,``J K
userAccount``K V
)``V W
;``W X
}aa 	
privatecc 
asynccc 
Taskcc 
<cc 
AccountUsercc &
?cc& '
>cc' (
FindUserByEmailcc) 8
(cc8 9
stringcc9 ?
	userEmailcc@ I
)ccI J
{dd 	
ifee 
(ee 
stringee 
.ee 
IsNullOrEmptyee $
(ee$ %
	userEmailee% .
)ee. /
)ee/ 0
returnee1 7
nullee8 <
;ee< =
returnff 
awaitff !
userAccountRepositoryff -
.ff- .
FirstOrDefaultAsyncff. A
(ffA B
xgg 
=>gg 
xgg 
.gg 
Emailgg 
.gg 
ToLowergg #
(gg# $
)gg$ %
==gg& (
	userEmailgg) 2
!gg2 3
.gg3 4
ToLowergg4 ;
(gg; <
)gg< =
)hh 
;hh 
}jj 	
publickk 
asynckk 
Taskkk 
<kk 
LoginResponsekk '
>kk' (

LoginAsynckk) 3
(kk3 4
LoginDtokk4 <
?kk< =
userkk> B
)kkB C
{ll 	
ifmm 
(mm 
usermm 
ismm 
nullmm 
)mm 
returnmm $
newmm% (
LoginResponsemm) 6
(mm6 7
falsemm7 <
,mm< =
nullmm= A
,mmA B
$strmmC S
)mmS T
;mmT U
varoo 
	checkUseroo 
=oo 
awaitoo !
FindUserByEmailoo" 1
(oo1 2
useroo2 6
.oo6 7
Emailoo7 <
!oo< =
)oo= >
;oo> ?
ifpp 
(pp 
	checkUserpp 
==pp 
nullpp !
)pp! "
returnpp# )
newpp* -
LoginResponsepp. ;
(pp; <
falsepp< A
,ppA B
nullppB F
,ppF G
$strppG I
,ppI J
$strppJ L
,ppL M
$"ppN P
{ppP Q
userppQ U
.ppU V
EmailppV [
}pp[ \
$strpp\ p
"ppp q
)ppq r
;ppr s
ifrr 
(rr 
!rr 
BCryptrr 
.rr 
Netrr 
.rr 
BCryptrr "
.rr" #
Verifyrr# )
(rr) *
userrr* .
.rr. /
Passwordrr/ 7
!rr7 8
,rr8 9
	checkUserrr: C
.rrC D
PasswordrrD L
!rrL M
)rrM N
)rrN O
returnss 
newss 
LoginResponsess (
(ss( )
falsess) .
,ss. /
nullss0 4
,ss4 5
$strss6 8
,ss8 9
$strss: <
,ss< =
$strss> P
)ssP Q
;ssQ R
varvv 
tokenvv 
=vv 
GenerateJwtTokenvv (
(vv( )
	checkUservv) 2
)vv2 3
;vv3 4
varww 
refreshTokenww 
=ww  
GenerateRefreshTokenww 3
(ww3 4
)ww4 5
;ww5 6
varyy 
findUseryy 
=yy 
awaityy  &
userRefreshTokenRepositoryyy! ;
.yy; <
FirstOrDefaultAsyncyy< O
(yyO P
xzz 
=>zz 
xzz 
.zz 
UserIdzz 
==zz 
	checkUserzz (
.zz( )
Idzz) +
)zz+ ,
;zz, -
if|| 
(|| 
findUser|| 
is|| 
not|| 
null||  $
)||$ %
{}} 
findUser~~ 
!~~ 
.~~ 
Token~~ 
=~~  !
refreshToken~~" .
;~~. /
await &
userRefreshTokenRepository 0
.0 1
UpdateAsync1 <
(< =
findUser= E
)E F
;F G
}
ÄÄ 
else
ÅÅ 
{
ÇÇ 
var
ÉÉ 
refreshTokenInfo
ÉÉ $
=
ÉÉ% &
new
ÉÉ' *
RefreshTokenInfo
ÉÉ+ ;
{
ÑÑ 
UserId
ÖÖ 
=
ÖÖ 
	checkUser
ÖÖ &
.
ÖÖ& '
Id
ÖÖ' )
,
ÖÖ) *
Token
ÜÜ 
=
ÜÜ 
refreshToken
ÜÜ (
}
àà 
;
àà 
await
ââ (
userRefreshTokenRepository
ââ 0
.
ââ0 1
InsertAsync
ââ1 <
(
ââ< =
refreshTokenInfo
ââ= M
)
ââM N
;
ââN O
}
ää 
var
åå 
userData
åå 
=
åå 
new
åå 
Payload
åå &
(
çç 
UserName
éé 
:
éé 
	checkUser
éé #
.
éé# $
UserName
éé$ ,
,
éé, -
UserType
èè 
:
èè 
	checkUser
èè #
.
èè# $
Type
èè$ (
,
èè( )
Email
êê 
:
êê 
	checkUser
êê  
.
êê  !
Email
êê! &
,
êê& '
Id
ëë 
:
ëë 
	checkUser
ëë 
.
ëë 
Id
ëë  
)
íí 
;
íí 
return
îî 
new
îî 
LoginResponse
îî $
(
îî$ %
true
îî% )
,
îî) *
userData
îî+ 3
,
îî3 4
token
îî5 :
,
îî: ;
refreshToken
îî< H
,
îîH I
$str
îîI a
)
îîa b
;
îîb c
}
ïï 	
private
óó 
static
óó 
string
óó "
GenerateRefreshToken
óó 2
(
óó2 3
)
óó3 4
{
òò 	
return
ôô 
Convert
ôô 
.
ôô 
ToBase64String
ôô (
(
ôô( )#
RandomNumberGenerator
ôô) >
.
ôô> ?
GetBytes
ôô? G
(
ôôG H
$num
ôôH J
)
ôôJ K
)
ôôK L
;
ôôL M
}
öö 	
private
úú 
string
úú 
GenerateJwtToken
úú '
(
úú' (
AccountUser
úú( 3
	checkUser
úú4 =
)
úú= >
{
ùù 	
Console
üü 
.
üü 
	WriteLine
üü 
(
üü 
$"
üü  
$str
üü  6
{
üü6 7
config
üü7 =
.
üü= >
Value
üü> C
}
üüC D
"
üüD E
)
üüE F
;
üüF G
if
†† 
(
†† 
	checkUser
†† 
==
†† 
null
†† !
)
††! "
{
°° 
throw
¢¢ 
new
¢¢ #
ArgumentNullException
¢¢ /
(
¢¢/ 0
nameof
¢¢0 6
(
¢¢6 7
	checkUser
¢¢7 @
)
¢¢@ A
)
¢¢A B
;
¢¢B C
}
££ 
if
•• 
(
•• 
string
•• 
.
••  
IsNullOrWhiteSpace
•• )
(
••) *
config
••* 0
?
••0 1
.
••1 2
Value
••2 7
?
••7 8
.
••8 9
Key
••9 <
)
••< =
)
••= >
throw
¶¶ 
new
¶¶ '
InvalidOperationException
¶¶ 3
(
¶¶3 4
$str
¶¶4 O
)
¶¶O P
;
¶¶P Q
if
®® 
(
®® 
string
®® 
.
®®  
IsNullOrWhiteSpace
®® )
(
®®) *
	checkUser
®®* 3
.
®®3 4
Email
®®4 9
)
®®9 :
)
®®: ;
throw
®®< A
new
®®B E
ArgumentException
®®F W
(
®®W X
$str
®®X |
)
®®| }
;
®®} ~
var
´´ 
securityKey
´´ 
=
´´  !
new
´´" %"
SymmetricSecurityKey
´´& :
(
´´: ;
Encoding
´´; C
.
´´C D
UTF8
´´D H
.
´´H I
GetBytes
´´I Q
(
´´Q R
config
´´R X
.
´´X Y
Value
´´Y ^
.
´´^ _
Key
´´_ b
)
´´b c
)
´´c d
;
´´d e
var
¨¨ 
credentials
¨¨ 
=
¨¨ 
new
¨¨ ! 
SigningCredentials
¨¨" 4
(
¨¨4 5
securityKey
¨¨5 @
,
¨¨@ A 
SecurityAlgorithms
¨¨B T
.
¨¨T U

HmacSha256
¨¨U _
)
¨¨_ `
;
¨¨` a
var
¿¿ 

userClaims
¿¿ 
=
¿¿ 
new
¿¿  
List
¿¿! %
<
¿¿% &
Claim
¿¿& +
>
¿¿+ ,
{
¡¡ 
new
¬¬ 
Claim
¬¬ 
(
¬¬ 

ClaimTypes
¬¬ $
.
¬¬$ %
NameIdentifier
¬¬% 3
,
¬¬3 4
	checkUser
¬¬5 >
.
¬¬> ?
Id
¬¬? A
.
¬¬A B
ToString
¬¬B J
(
¬¬J K
)
¬¬K L
)
¬¬L M
,
¬¬M N
new
√√ 
Claim
√√ 
(
√√ 

ClaimTypes
√√ $
.
√√$ %
Email
√√% *
,
√√* +
	checkUser
√√, 5
.
√√5 6
Email
√√6 ;
)
√√; <
,
√√< =
new
ƒƒ 
Claim
ƒƒ 
(
ƒƒ 

ClaimTypes
ƒƒ $
.
ƒƒ$ %
Name
ƒƒ% )
,
ƒƒ) *
	checkUser
ƒƒ+ 4
.
ƒƒ4 5
UserName
ƒƒ5 =
)
ƒƒ= >
}
≈≈ 
;
≈≈ 
var
«« 
token
«« 
=
«« 
new
«« 
JwtSecurityToken
«« ,
(
««, -
issuer
»» 
:
»» 
config
»» 
.
»» 
Value
»» $
.
»»$ %
Issuer
»»% +
,
»»+ ,
audience
…… 
:
…… 
config
……  
.
……  !
Value
……! &
.
……& '
Audience
……' /
,
……/ 0
claims
   
:
   

userClaims
   "
,
  " #
expires
ÀÀ 
:
ÀÀ 
DateTime
ÀÀ !
.
ÀÀ! "
Now
ÀÀ" %
.
ÀÀ% &
AddDays
ÀÀ& -
(
ÀÀ- .
$num
ÀÀ. 0
)
ÀÀ0 1
,
ÀÀ1 2 
signingCredentials
ÃÃ "
:
ÃÃ" #
credentials
ÃÃ$ /
)
ÕÕ 
;
ÕÕ 
return
œœ 
new
œœ %
JwtSecurityTokenHandler
œœ .
(
œœ. /
)
œœ/ 0
.
œœ0 1

WriteToken
œœ1 ;
(
œœ; <
token
œœ< A
)
œœA B
;
œœB C
}
–– 	
public
““ 
Task
““ 
<
““ 
LoginResponse
““ !
>
““! "
RefreshTokenAsync
““# 4
(
““4 5
RefreshTokenDto
““5 D
user
““E I
)
““I J
{
”” 	
throw
‘‘ 
new
‘‘ %
NotImplementedException
‘‘ -
(
‘‘- .
)
‘‘. /
;
‘‘/ 0
}
’’ 	
[
◊◊ 	
	Authorize
◊◊	 
]
◊◊ 
public
ÿÿ 
async
ÿÿ 
Task
ÿÿ 
<
ÿÿ 
GeneralResponse
ÿÿ )
>
ÿÿ) *
UpdateAsync
ÿÿ+ 6
(
ÿÿ6 7
[
ÿÿ7 8
FromForm
ÿÿ8 @
]
ÿÿ@ A
UpdateAccountDto
ÿÿB R
?
ÿÿR S
dto
ÿÿT W
)
ÿÿW X
{
ŸŸ 	
if
⁄⁄ 
(
⁄⁄ 
dto
⁄⁄ 
is
⁄⁄ 
null
⁄⁄ 
)
⁄⁄ 
return
⁄⁄ #
new
⁄⁄$ '
GeneralResponse
⁄⁄( 7
(
⁄⁄7 8
false
⁄⁄8 =
,
⁄⁄= >
$str
⁄⁄? N
)
⁄⁄N O
;
⁄⁄O P
var
‹‹ 
user
‹‹ 
=
‹‹ 
await
‹‹ #
userAccountRepository
‹‹ 2
.
‹‹2 3
	FindAsync
‹‹3 <
(
‹‹< =
dto
‹‹= @
.
‹‹@ A
Id
‹‹A C
)
‹‹C D
;
‹‹D E
if
›› 
(
›› 
user
›› 
==
›› 
null
›› 
)
›› 
return
›› $
new
››% (
GeneralResponse
››) 8
(
››8 9
false
››9 >
,
››> ?
$str
››@ P
)
››P Q
;
››Q R
user
ﬂﬂ 
.
ﬂﬂ 
UserName
ﬂﬂ 
=
ﬂﬂ 
dto
ﬂﬂ 
.
ﬂﬂ  
UserName
ﬂﬂ  (
;
ﬂﬂ( )
user
‡‡ 
.
‡‡ 
Phone
‡‡ 
=
‡‡ 
dto
‡‡ 
.
‡‡ 
PhoneNumber
‡‡ (
;
‡‡( )
user
·· 
.
·· 
WhatsApp
·· 
=
·· 
dto
·· 
.
··  
WhatsApp
··  (
;
··( )
user
‚‚ 
.
‚‚ 
Country
‚‚ 
=
‚‚ 
dto
‚‚ 
.
‚‚ 
Country
‚‚ &
;
‚‚& '
user
„„ 
.
„„ 
CompanyName
„„ 
=
„„ 
dto
„„ "
.
„„" #
CompanyName
„„# .
;
„„. /
user
‰‰ 
.
‰‰ 
CompanyEmail
‰‰ 
=
‰‰ 
dto
‰‰  #
.
‰‰# $
CompanyMail
‰‰$ /
;
‰‰/ 0
user
ÂÂ 
.
ÂÂ 

Department
ÂÂ 
=
ÂÂ 
dto
ÂÂ !
.
ÂÂ! "

Department
ÂÂ" ,
;
ÂÂ, -
user
ÊÊ 
.
ÊÊ 
JobPosition
ÊÊ 
=
ÊÊ 
dto
ÊÊ "
.
ÊÊ" #
JobPosition
ÊÊ# .
;
ÊÊ. /
var
ËË 
profilePicture
ËË 
=
ËË  
dto
ËË! $
.
ËË$ %
ProfilePicture
ËË% 3
;
ËË3 4
if
ÍÍ 
(
ÍÍ 
profilePicture
ÍÍ 
!=
ÍÍ !
null
ÍÍ" &
)
ÍÍ& '
{
ÎÎ 
var
ÏÏ 
fileName
ÏÏ 
=
ÏÏ 
Path
ÏÏ #
.
ÏÏ# $
GetFileName
ÏÏ$ /
(
ÏÏ/ 0
profilePicture
ÏÏ0 >
.
ÏÏ> ?
FileName
ÏÏ? G
)
ÏÏG H
;
ÏÏH I
var
ÌÌ 
uniqueFileName
ÌÌ "
=
ÌÌ# $
$"
ÌÌ% '
{
ÌÌ' (
Guid
ÌÌ( ,
.
ÌÌ, -
NewGuid
ÌÌ- 4
(
ÌÌ4 5
)
ÌÌ5 6
}
ÌÌ6 7
$str
ÌÌ7 8
{
ÌÌ8 9
fileName
ÌÌ9 A
}
ÌÌA B
"
ÌÌB C
;
ÌÌC D
var
ÓÓ 
uploadsPath
ÓÓ 
=
ÓÓ  !
Path
ÓÓ" &
.
ÓÓ& '
Combine
ÓÓ' .
(
ÓÓ. /
	Directory
ÓÓ/ 8
.
ÓÓ8 9!
GetCurrentDirectory
ÓÓ9 L
(
ÓÓL M
)
ÓÓM N
,
ÓÓN O
$str
ÓÓP Y
,
ÓÓY Z
$str
ÓÓ[ d
)
ÓÓd e
;
ÓÓe f
if
 
(
 
!
 
	Directory
 
.
 
Exists
 %
(
% &
uploadsPath
& 1
)
1 2
)
2 3
	Directory
ÒÒ 
.
ÒÒ 
CreateDirectory
ÒÒ -
(
ÒÒ- .
uploadsPath
ÒÒ. 9
)
ÒÒ9 :
;
ÒÒ: ;
var
ÛÛ 
filePath
ÛÛ 
=
ÛÛ 
Path
ÛÛ #
.
ÛÛ# $
Combine
ÛÛ$ +
(
ÛÛ+ ,
uploadsPath
ÛÛ, 7
,
ÛÛ7 8
uniqueFileName
ÛÛ9 G
)
ÛÛG H
;
ÛÛH I
using
ÙÙ 
(
ÙÙ 
var
ÙÙ 
stream
ÙÙ !
=
ÙÙ" #
new
ÙÙ$ '

FileStream
ÙÙ( 2
(
ÙÙ2 3
filePath
ÙÙ3 ;
,
ÙÙ; <
FileMode
ÙÙ= E
.
ÙÙE F
Create
ÙÙF L
)
ÙÙL M
)
ÙÙM N
{
ıı 
await
ˆˆ 
profilePicture
ˆˆ (
.
ˆˆ( )
CopyToAsync
ˆˆ) 4
(
ˆˆ4 5
stream
ˆˆ5 ;
)
ˆˆ; <
;
ˆˆ< =
}
˜˜ 
var
˘˘ 
request
˘˘ 
=
˘˘ "
_httpContextAccessor
˘˘ 2
.
˘˘2 3
HttpContext
˘˘3 >
!
˘˘> ?
.
˘˘? @
Request
˘˘@ G
;
˘˘G H
var
˙˙ 
baseUrl
˙˙ 
=
˙˙ 
$"
˙˙  
{
˙˙  !
request
˙˙! (
.
˙˙( )
Scheme
˙˙) /
}
˙˙/ 0
$str
˙˙0 3
{
˙˙3 4
request
˙˙4 ;
.
˙˙; <
Host
˙˙< @
}
˙˙@ A
"
˙˙A B
;
˙˙B C
user
˚˚ 
.
˚˚ 
ProfilePictureUrl
˚˚ &
=
˚˚' (
$"
˚˚) +
{
˚˚+ ,
baseUrl
˚˚, 3
}
˚˚3 4
$str
˚˚4 =
{
˚˚= >
uniqueFileName
˚˚> L
}
˚˚L M
"
˚˚M N
;
˚˚N O
}
¸¸ 
if
ˇˇ 
(
ˇˇ 
dto
ˇˇ 
.
ˇˇ 
Password
ˇˇ 
is
ˇˇ 
not
ˇˇ  #
null
ˇˇ$ (
)
ˇˇ) *
{
ÄÄ 
user
ÅÅ 
.
ÅÅ 
Password
ÅÅ 
=
ÅÅ 
BCrypt
ÅÅ  &
.
ÅÅ& '
Net
ÅÅ' *
.
ÅÅ* +
BCrypt
ÅÅ+ 1
.
ÅÅ1 2
HashPassword
ÅÅ2 >
(
ÅÅ> ?
dto
ÅÅ? B
.
ÅÅB C
Password
ÅÅC K
)
ÅÅK L
;
ÅÅL M
}
ÇÇ 
await
ÑÑ #
userAccountRepository
ÑÑ '
.
ÑÑ' (
UpdateAsync
ÑÑ( 3
(
ÑÑ3 4
user
ÑÑ4 8
)
ÑÑ8 9
;
ÑÑ9 :
return
ÖÖ 
new
ÖÖ 
GeneralResponse
ÖÖ &
(
ÖÖ& '
true
ÖÖ' +
,
ÖÖ+ ,
$str
ÖÖ- K
,
ÖÖK L
user
ÖÖM Q
)
ÖÖQ R
;
ÖÖR S
}
ÜÜ 	
public
àà 
async
àà 
Task
àà 
<
àà 
GeneralResponse
àà )
>
àà) *
GetUserProfile
àà+ 9
(
àà9 :
Guid
àà: >
userId
àà? E
)
ààE F
{
ââ 	
var
ää 
user
ää 
=
ää 
await
ää #
userAccountRepository
ää 2
.
ää2 3
GetAsync
ää3 ;
(
ää; <
userId
ää< B
)
ääB C
;
ääC D
return
åå 
new
åå 
GeneralResponse
åå &
(
åå& '
true
åå' +
,
åå+ ,
$str
åå- 6
,
åå6 7
user
åå7 ;
)
åå; <
;
åå< =
}
éé 	
}
èè 
}êê ˘U
èD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PublicProperties\PublicPropertiesAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
PublicProperties  0
;0 1
public 
class &
PublicPropertiesAppService '
(' (
IRepository 
< 
Property 
, 
Guid 
> 

repository  *
,* +!
PropertyMiniDbContext 
	dbContext #
)# $
: 
ApplicationService 
, %
IPublicPropertyAppService 3
{ 
public 

async 
Task 
< 
GeneralResponse %
>% &&
GetPublicPropertyListAsync' A
(A B
)B C
{ 
var 


properties 
= 
await 
	dbContext '
.' (

Properties( 2
. 
Include 
( 
p 
=> 
p 
. 
PropertyAmenities -
)- .
. 
ThenInclude 
( 
p 
=> 
p 
.  
Amenity  '
)' (
. 
Include 
( 
x 
=> 
x 
. 
PropertyType (
)( )
. 
Include 
( 
x 
=> 
x 
. 
PropertyFeatures ,
), -
. 
Include 
( 
x 
=> 
x 
. 
PropertyAmenities -
)- .
.   
Include   
(   
x   
=>   
x   
.   
Owner   !
)  ! "
.!! 
Include!! 
(!! 
x!! 
=>!! 
x!! 
.!! 
PropertyImages!! *
)!!* +
."" 
Include"" 
("" 
p"" 
=>"" 
p"" 
.""  
PropertyNearbyPlaces"" 0
)""0 1
.## 
ThenInclude## 
(## 
p## 
=>## 
p## 
.##  
NearbyPlace##  +
)##+ ,
.$$ 
ToListAsync$$ 
($$ 
)$$ 
;$$ 
var'' 
list'' 
='' 
ObjectMapper'' 
.'' 
Map'' "
<''" #
List''# '
<''' (
Property''( 0
>''0 1
,''1 2
List''3 7
<''7 8
PropertyListDto''8 G
>''G H
>''H I
(''I J

properties''J T
)''T U
;''U V
return(( 
new(( 
GeneralResponse(( "
(((" #
true((# '
,((' (
$str(() 2
,((2 3
list((4 8
)((8 9
;((9 :
}** 
public.. 

async.. 
Task.. 
<.. 
GeneralResponse.. %
>..% &"
GetPublicPropertyAsync..' =
(..= >
Guid..> B
id..C E
)..E F
{// 
try00 
{11 	
var22 
property22 
=22 
await22  
	dbContext22! *
.22* +

Properties22+ 5
.33 
Include33 
(33 
p33 
=>33 
p33 
.33 
PropertyAmenities33 ,
)33, -
.44 
ThenInclude44 
(44 
p44 
=>44 
p44 
.44 
Amenity44 &
)44& '
.55 
Include55 
(55 
p55 
=>55 
p55 
.55 
PropertyImages55 )
)55) *
.66 
Include66 
(66 
p66 
=>66 
p66 
.66 
PropertyFeatures66 +
)66+ ,
.77 
Include77 
(77 
p77 
=>77 
p77 
.77 
PropertyType77 '
)77' (
.88 
Include88 
(88 
p88 
=>88 
p88 
.88  
PropertyNearbyPlaces88 /
)88/ 0
.99 
ThenInclude99 
(99 
p99 
=>99 
p99 
.99 
NearbyPlace99 *
)99* +
.:: 
Include:: 
(:: 
p:: 
=>:: 
p:: 
.:: 
Owner::  
)::  !
.;; 
Include;; 
(;; 
p;; 
=>;; 
p;; 
.;; 
Governorate;; %
);;% &
.<< 
FirstOrDefaultAsync<< 
(<<  
p<<  !
=><<" $
p<<% &
.<<& '
Id<<' )
==<<* ,
id<<- /
)<</ 0
;<<0 1
var== 
result== 
=== 
ObjectMapper== %
.==% &
Map==& )
<==) *
Property==* 2
,==2 3
PropertyListDto==4 C
>==C D
(==D E
property==E M
)==M N
;==N O
return>> 
new>> 
GeneralResponse>> &
(>>& '
true>>' +
,>>+ ,
$str>>- 6
,>>6 7
result>>8 >
)>>> ?
;>>? @
}?? 	
catch@@ 
(@@ 
	Exception@@ 
ex@@ 
)@@ 
{@@ 
returnAA 
newAA 
GeneralResponseAA &
(AA& '
falseAA' ,
,AA, -
exAA. 0
.AA0 1
MessageAA1 8
,AA8 9
exAA: <
.AA< =

StackTraceAA= G
)AAG H
;AAH I
}BB 	
}DD 
publicFF 

asyncFF 
TaskFF 
<FF 
ListFF 
<FF 
PropertyDtoFF &
>FF& '
>FF' (&
GetFilteredPropertiesAsyncFF) C
(FFC D
PropertyFilterDtoFFD U
filterFFV \
)FF\ ]
{GG 
varII 
sqlII 
=II 
$strII q
;IIq r
varJJ 
resultJJ 
=JJ 
awaitJJ 
	dbContextJJ $
.JJ$ %

PropertiesJJ% /
.KK 

FromSqlRawKK 
(KK 
sqlKK 
,KK 
newLL 
SqlParameterLL  
(LL  !
$strLL! 1
,LL1 2
filterLL3 9
.LL9 :
GovernorateIdLL: G
??LLH J
(LLK L
objectLLL R
)LLR S
DBNullLLS Y
.LLY Z
ValueLLZ _
)LL_ `
,LL` a
newMM 
SqlParameterMM  
(MM  !
$strMM! /
,MM/ 0
filterMM1 7
.MM7 8
TypeMM8 <
??MM= ?
(MM@ A
objectMMA G
)MMG H
DBNullMMH N
.MMN O
ValueMMO T
)MMT U
,MMU V
newNN 
SqlParameterNN  
(NN  !
$strNN! ,
,NN, -
filterNN. 4
.NN4 5
MinPriceNN5 =
??NN> @
(NNA B
objectNNB H
)NNH I
DBNullNNI O
.NNO P
ValueNNP U
)NNU V
,NNV W
newOO 
SqlParameterOO  
(OO  !
$strOO! ,
,OO, -
filterOO. 4
.OO4 5
MaxPriceOO5 =
??OO> @
(OOA B
objectOOB H
)OOH I
DBNullOOI O
.OOO P
ValueOOP U
)OOU V
,OOV W
newPP 
SqlParameterPP  
(PP  !
$strPP! +
,PP+ ,
filterPP- 3
.PP3 4
MinAreaPP4 ;
??PP< >
(PP? @
objectPP@ F
)PPF G
DBNullPPG M
.PPM N
ValuePPN S
)PPS T
,PPT U
newQQ 
SqlParameterQQ  
(QQ  !
$strQQ! +
,QQ+ ,
filterQQ- 3
.QQ3 4
MaxAreaQQ4 ;
??QQ< >
(QQ? @
objectQQ@ F
)QQF G
DBNullQQG M
.QQM N
ValueQQN S
)QQS T
,QQT U
newRR 
SqlParameterRR  
(RR  !
$strRR! *
,RR* +
filterRR, 2
.RR2 3
StatusRR3 9
??RR: <
(RR= >
objectRR> D
)RRD E
DBNullRRE K
.RRK L
ValueRRL Q
)RRQ R
,RRR S
newSS 
SqlParameterSS  
(SS  !
$strSS! )
,SS) *
filterSS+ 1
.SS1 2
RoomsSS2 7
??SS8 :
(SS; <
objectSS< B
)SSB C
DBNullSSC I
.SSI J
ValueSSJ O
)SSO P
)TT 
.TT 
ToListAsyncTT 
(TT 
)TT 
;TT 
returnVV 
ObjectMapperVV 
.VV 
MapVV 
<VV  
ListVV  $
<VV$ %
PropertyVV% -
>VV- .
,VV. /
ListVV0 4
<VV4 5
PropertyDtoVV5 @
>VV@ A
>VVA B
(VVB C
resultVVC I
)VVI J
;VVJ K
}WW 
publicYY 

asyncYY 
TaskYY 
<YY 
GeneralResponseYY %
>YY% &+
GetExploreHomePropertyListAsyncYY' F
(YYF G
)YYG H
{ZZ 
try[[ 
{\\ 	
var]] 

properties]] 
=]] 
await]] "
	dbContext]]# ,
.]], -

Properties]]- 7
.]]7 8
Include]]8 ?
(]]? @
p]]@ A
=>]]A C
p]]C D
.]]D E
Governorate]]E P
)]]P Q
.]]Q R
ToListAsync]]R ]
(]]] ^
)]]^ _
;]]_ `
var`` 
list`` 
=`` 
ObjectMapper`` #
.``# $
Map``$ '
<``' (
List``( ,
<``, -
Property``- 5
>``5 6
,``6 7
List``8 <
<``< =
ExploreHomesDto``= L
>``L M
>``M N
(``N O

properties``O Y
)``Y Z
;``Z [
returnaa 
newaa 
GeneralResponseaa &
(aa& '
trueaa' +
,aa+ ,
$straa- 6
,aa6 7
listaa8 <
)aa< =
;aa= >
}bb 	
catchcc 
(cc 
	Exceptioncc 
excc 
)cc 
{dd 	
returnee 
newee 
GeneralResponseee &
(ee& '
falseee' ,
,ee, -
exee. 0
.ee0 1
Messageee1 8
,ee8 9
exee: <
.ee< =

StackTraceee= G
)eeG H
;eeH I
}ff 	
}gg 
}hh ç
àD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PublicProperties\PropertyFilterInput.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
PublicProperties  0
{ 
public 

class 
PropertyFilterInput $
{		 
public

 
Guid

 
?

 
GovernorateId

 "
{

# $
get

% (
;

( )
set

* -
;

- .
}

/ 0
public 
string 
? 
Type 
{ 
get !
;! "
set# &
;& '
}( )
public 
decimal 
? 
MinPrice  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
decimal 
? 
MaxPrice  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
double 
? 
MinArea 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
double 
? 
MaxArea 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
} Í'
àD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PropertyTypes\PropertyTypeAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
PropertyTypes  -
{ 
public 

class "
PropertyTypeAppService '
:' (
ApplicationService) ;
,; <#
IPropertyTypeAppService= T
{ 
private 
readonly 
IRepository $
<$ %
PropertyType% 1
,1 2
Guid3 7
>7 8
_repository9 D
;D E
public "
PropertyTypeAppService %
(% &
IRepository& 1
<1 2
PropertyType2 >
,> ?
Guid@ D
>D E

repositoryF P
)P Q
{ 	
_repository 
= 

repository $
;$ %
} 	
public 
async 
Task 
< 
PropertyTypeDto )
>) *
CreateAsync+ 6
(6 7'
CreateUpdatePropertyTypeDto7 R
inputS X
)X Y
{ 	
var 
propertyType 
= 
new "
PropertyType# /
{ 
Name 
= 
input 
. 
Name !
} 
; 
await 
_repository 
. 
InsertAsync )
() *
propertyType* 6
)6 7
;7 8
return 
ObjectMapper 
.  
Map  #
<# $
PropertyType$ 0
,0 1
PropertyTypeDto2 A
>A B
(B C
propertyTypeC O
)O P
;P Q
}   	
public"" 
async"" 
Task"" 
DeleteAsync"" %
(""% &
Guid""& *
id""+ -
)""- .
{## 	
var$$ 
propertyType$$ 
=$$ 
await$$ $
_repository$$% 0
.$$0 1
GetAsync$$1 9
($$9 :
id$$: <
)$$< =
;$$= >
if%% 
(%% 
propertyType%% 
==%% 
null%%  $
)%%$ %
{&& 
throw'' 
new'' 
	Exception'' #
(''# $
$str''$ @
)''@ A
;''A B
}(( 
await)) 
_repository)) 
.)) 
DeleteAsync)) )
())) *
propertyType))* 6
)))6 7
;))7 8
}** 	
public,, 
async,, 
Task,, 
<,, 
PropertyTypeDto,, *
>,,* +
GetAsync,,, 4
(,,4 5
Guid,,5 9
id,,: <
),,< =
{-- 	
var// 
propertyType// 
=// 
await// $
_repository//% 0
.//0 1
GetAsync//1 9
(//9 :
id//: <
)//< =
;//= >
return00 
ObjectMapper00 
.00  
Map00  #
<00# $
PropertyType00$ 0
,000 1
PropertyTypeDto002 A
>00A B
(00B C
propertyType00C O
)00O P
;00P Q
}11 	
public33 
async33 
Task33 
<33 
List33 
<33 
PropertyTypeDto33 .
>33. /
>33/ 0
GetListAsync331 =
(33= >
)33> ?
{44 	
var55 
propertyTypes55 
=55 
await55  %
_repository55& 1
.551 2
GetListAsync552 >
(55> ?
)55? @
;55@ A
return66 
ObjectMapper66 
.66  
Map66  #
<66# $
List66$ (
<66( )
PropertyType66) 5
>665 6
,666 7
List668 <
<66< =
PropertyTypeDto66= L
>66L M
>66M N
(66N O
propertyTypes66O \
)66\ ]
;66] ^
}77 	
public99 
async99 
Task99 
<99 
PropertyTypeDto99 )
>99) *
UpdateAsync99+ 6
(996 7
Guid997 ;
id99< >
,99> ?'
CreateUpdatePropertyTypeDto99@ [
input99\ a
)99a b
{:: 	
var;; 
propertyType;; 
=;; 
await;; $
_repository;;% 0
.;;0 1
GetAsync;;1 9
(;;9 :
id;;: <
);;< =
;;;= >
ObjectMapper<< 
.<< 
Map<< 
(<< 
input<< "
,<<" #
propertyType<<$ 0
)<<0 1
;<<1 2
return== 
ObjectMapper== 
.==  
Map==  #
<==# $
PropertyType==$ 0
,==0 1
PropertyTypeDto==2 A
>==A B
(==B C
propertyType==C O
)==O P
;==P Q
}>> 	
}?? 
}AA í
zD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PropertyMiniAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
;  
public 
abstract 
class "
PropertyMiniAppService ,
:- .
ApplicationService/ A
{ 
	protected "
PropertyMiniAppService $
($ %
)% &
{  
LocalizationResource 
= 
typeof %
(% & 
PropertyMiniResource& :
): ;
;; <
} 
} †
ÅD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PropertyMiniApplicationModule.cs
	namespace

 	
SawaTech


 
.

 
PropertyMini

 
;

  
[ 
	DependsOn 

(
 
typeof 

(
 $
PropertyMiniDomainModule #
)# $
,$ %
typeof 

(
 '
AbpAccountApplicationModule &
)& '
,' (
typeof 

(
 2
&PropertyMiniApplicationContractsModule 1
)1 2
,2 3
typeof 

(
 (
AbpIdentityApplicationModule '
)' (
,( )
typeof 

(
 4
(AbpPermissionManagementApplicationModule 3
)3 4
,4 5
typeof 

(
 1
%AbpFeatureManagementApplicationModule 0
)0 1
) 
] 
public 
class )
PropertyMiniApplicationModule *
:+ ,
	AbpModule- 6
{ 
public 

override 
void 
ConfigureServices *
(* +'
ServiceConfigurationContext+ F
contextG N
)N O
{ 
	Configure 
<  
AbpAutoMapperOptions &
>& '
(' (
options( /
=>0 2
{ 	
options 
. 
AddMaps 
< )
PropertyMiniApplicationModule 9
>9 :
(: ;
); <
;< =
} 	
)	 

;
 
} 
} œh
åD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PropertyMiniApplicationAutoMapperProfile.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
;  
public 
class 4
(PropertyMiniApplicationAutoMapperProfile 5
:6 7
Profile8 ?
{ 
public 
4
(PropertyMiniApplicationAutoMapperProfile 3
(3 4
)4 5
{ 
	CreateMap 
< 
Property 
, 
PropertyDto '
>' (
(( )
)) *
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
Rooms$ )
,) *
opt+ .
=>/ 1
opt2 5
.5 6
MapFrom6 =
(= >
src> A
=>B D
srcE H
.H I
RoomsI N
)N O
)O P
. 
	ForMember 
( 
dest 
=> 
dest  $
.$ %
Images% +
,+ ,
opt- 0
=>1 3
opt4 7
.7 8
MapFrom8 ?
(? @
src@ C
=>D F
srcG J
.J K
PropertyImagesK Y
)Y Z
)Z [
. 
	ForMember 
( 
dest 
=> 
dest #
.# $
PropertyType$ 0
,0 1
opt 
=> 
opt 
. 
MapFrom "
(" #
src# &
=>' )
src* -
.- .
PropertyType. :
): ;
); <
;< =
	CreateMap   
<   
Property   
,   
PropertyListDto   +
>  + ,
(  , -
)  - .
.!! 
	ForMember!! 
(!! 
dest!! 
=>!! 
dest!! #
.!!# $
Rooms!!$ )
,!!) *
opt!!+ .
=>!!/ 1
opt!!2 5
.!!5 6
MapFrom!!6 =
(!!= >
src!!> A
=>!!B D
src!!E H
.!!H I
Rooms!!I N
)!!N O
)!!O P
."" 
	ForMember"" 
("" 
dest"" 
=>"" 
dest"" #
.""# $
PropertyType""$ 0
,""0 1
opt## 
=>## 
opt## 
.## 
MapFrom## "
(##" #
src### &
=>##' )
src##* -
.##- .
PropertyType##. :
)##: ;
)$$ 
.%% 
	ForMember%% 
(%% 
dest%% 
=>%% 
dest%% !
.%%! "
Owner%%" '
,%%' (
opt%%) ,
=>%%, .
opt%%. 1
.%%1 2
MapFrom%%2 9
(%%9 :
src%%: =
=>%%= ?
src%%? B
.%%B C
Owner%%C H
)%%H I
)%%I J
;%%J K
	CreateMap'' 
<'' 
Property'' 
,'' 
PropertyDetailDto'' -
>''- .
(''. /
)''/ 0
.(( 
	ForMember(( 
((( 
dest)) 
=>)) 
dest)) 
.)) 
	Amenities)) &
,))& '
opt** 
=>** 
opt++ 
.++ 
MapFrom++ 
(++  
src++  #
=>++$ &
src,, 
.,, 
	Amenities,, %
)-- 
).. 
;.. 
	CreateMap44 
<44 
AccountUser44 
,44 
PropertyOwnerDto44 /
>44/ 0
(440 1
)441 2
.55 
	ForMember55 
(55 
dest55 
=>55 
dest55 !
.55! "
Name55" &
,55& '
opt55( +
=>55+ -
opt55- 0
.550 1
MapFrom551 8
(558 9
src559 <
=>55< >
src55> A
.55A B
UserName55B J
)55J K
)55K L
;55L M
	CreateMap77 
<77 
PropertyImage77 
,77  
PropertyImageDto77! 1
>771 2
(772 3
)773 4
.88 
	ForMember88 
(88 
dest88 
=>88 
dest88 "
.88" #
Url88# &
,88& '
opt88( +
=>88, .
opt88/ 2
.882 3
MapFrom883 :
(88: ;
src88; >
=>88? A
src88B E
.88E F
Url88F I
)88I J
)88J K
;88K L
	CreateMap;; 
<;; #
CreateUpdatePropertyDto;; )
,;;) *
Property;;+ 3
>;;3 4
(;;4 5
);;5 6
.<< 
	ForMember<< 
(<< 
dest== 
=>== 
dest== 
.== 
	Amenities== &
,==& '
opt>> 
=>>> 
opt?? 
.?? 
MapFrom?? 
(??  
src??  #
=>??$ &
src@@ 
.@@ 
	Amenities@@ %
.@@% &
Select@@& ,
(@@, -
name@@- 1
=>@@2 4
new@@5 8
Amenity@@9 @
{@@A B
Name@@C G
=@@H I
name@@J N
}@@O P
)@@P Q
.@@Q R
ToList@@R X
(@@X Y
)@@Y Z
)AA 
)BB 
;BB 
	CreateMapEE 
<EE 
FeatureEE 
,EE 
PropertyFeatureDtoEE -
>EE- .
(EE. /
)EE/ 0
;EE0 1
	CreateMapFF 
<FF +
CreateUpdatePropertyFeaturesDtoFF 1
,FF1 2
FeatureFF3 :
>FF: ;
(FF; <
)FF< =
;FF= >
	CreateMapHH 
<HH 
GovernorateHH 
,HH 
GovernorateDtoHH -
>HH- .
(HH. /
)HH/ 0
;HH0 1
	CreateMapII 
<II 
GovernorateII 
,II "
PropertyGovernorateDtoII 5
>II5 6
(II6 7
)II7 8
.II8 9
	ForMemberII9 B
(IIB C
destIIC G
=>IIG I
destIII M
.IIM N
NameIIN R
,IIR S
optIIT W
=>IIW Y
optIIY \
.II\ ]
MapFromII] d
(IId e
srcIIe h
=>IIh j
srcIIj m
.IIm n
NameIIn r
)IIr s
)IIs t
;IIt u
	CreateMapJJ 
<JJ &
CreateUpdateGovernorateDtoJJ ,
,JJ, -
GovernorateJJ. 9
>JJ9 :
(JJ: ;
)JJ; <
;JJ< =
	CreateMapLL 
<LL 
AccountUserLL 
,LL 
PropertyOwnerDtoLL /
>LL/ 0
(LL0 1
)LL1 2
.MM 
	ForMemberMM 
(MM 
destMM 
=>MM 
destMM #
.MM# $
IdMM$ &
,MM& '
optMM( +
=>MM, .
optMM/ 2
.MM2 3
MapFromMM3 :
(MM: ;
srcMM; >
=>MM? A
srcMMB E
.MME F
IdMMF H
)MMH I
)MMI J
.NN 
	ForMemberNN 
(NN 
destNN 
=>NN 
destNN #
.NN# $
NameNN$ (
,NN( )
optNN* -
=>NN. 0
optNN1 4
.NN4 5
MapFromNN5 <
(NN< =
srcNN= @
=>NNA C
srcNND G
.NNG H
UserNameNNH P
)NNP Q
)NNQ R
.OO 
	ForMemberOO 
(OO 
destOO 
=>OO 
destOO #
.OO# $
EmailOO$ )
,OO) *
optOO+ .
=>OO/ 1
optOO2 5
.OO5 6
MapFromOO6 =
(OO= >
srcOO> A
=>OOB D
srcOOE H
.OOH I
EmailOOI N
)OON O
)OOO P
.PP 
	ForMemberPP 
(PP 
destPP 
=>PP 
destPP #
.PP# $
PhoneNumberPP$ /
,PP/ 0
optPP1 4
=>PP5 7
optPP8 ;
.PP; <
MapFromPP< C
(PPC D
srcPPD G
=>PPH J
srcPPK N
.PPN O
PhonePPO T
)PPT U
)RR 
;RR 
	CreateMapTT 
<TT 
PropertyTypeTT 
,TT 
PropertyTypeDtoTT  /
>TT/ 0
(TT0 1
)TT1 2
.UU 
	ForMemberUU 
(UU 
destUU 
=>UU 
destUU #
.UU# $
NameUU$ (
,UU( )
optUU* -
=>UU. 0
optUU1 4
.UU4 5
MapFromUU5 <
(UU< =
srcUU= @
=>UUA C
srcUUD G
.UUG H
NameUUH L
)UUL M
)UUM N
.VV 
	ForMemberVV 
(VV 
destVV 
=>VV 
destVV #
.VV# $
IdVV$ &
,VV& '
optVV( +
=>VV, .
optVV/ 2
.VV2 3
MapFromVV3 :
(VV: ;
srcVV; >
=>VV? A
srcVVB E
.VVE F
IdVVF H
)VVH I
)VVI J
;VVJ K
	CreateMapXX 
<XX '
CreateUpdatePropertyTypeDtoXX -
,XX- .
PropertyTypeXX/ ;
>XX; <
(XX< =
)XX= >
.YY 
	ForMemberYY 
(YY 
destYY 
=>YY 
destYY #
.YY# $
NameYY$ (
,YY( )
optYY* -
=>YY. 0
optYY1 4
.YY4 5
MapFromYY5 <
(YY< =
srcYY= @
=>YYA C
srcYYD G
.YYG H
NameYYH L
)YYL M
)YYM N
;YYN O
	CreateMap[[ 
<[[ 
Amenity[[ 
,[[ 

AmenityDto[[ %
>[[% &
([[& '
)[[' (
;[[( )
	CreateMap]] 
<]] 
Amenity]] 
,]] $
SinglePropertyAmenityDto]] 3
>]]3 4
(]]4 5
)]]5 6
;]]6 7
	CreateMap__ 
<__ "
CreateUpdateAmenityDto__ (
,__( )
Amenity__* 1
>__1 2
(__2 3
)__3 4
.`` 
	ForMember`` 
(`` 
dest`` 
=>`` 
dest`` #
.``# $
Name``$ (
,``( )
opt``* -
=>``. 0
opt``1 4
.``4 5
MapFrom``5 <
(``< =
src``= @
=>``A C
src``D G
.``G H
Name``H L
)``L M
)``M N
;``N O
	CreateMapbb 
<bb #
CreateUpdateNearbyPlacebb )
,bb) *
NearbyPlacebb+ 6
>bb6 7
(bb7 8
)bb8 9
;bb9 :
	CreateMapdd 
<dd 
PropertyNearbyPlacedd %
,dd% &
NearbyPlaceDtodd' 5
>dd5 6
(dd6 7
)dd7 8
.ee 
	ForMemberee 
(ee 
destee 
=>ee 
destee #
.ee# $
Nameee$ (
,ee( )
optee* -
=>ee. 0
optee1 4
.ee4 5
MapFromee5 <
(ee< =
srcee= @
=>eeA C
srceeD G
.eeG H
NearbyPlaceeeH S
.eeS T
NameeeT X
)eeX Y
)eeY Z
.ff 
	ForMemberff 
(ff 
destff 
=>ff 
destff #
.ff# $
Idff$ &
,ff& '
optff( +
=>ff, .
optff/ 2
.ff2 3
MapFromff3 :
(ff: ;
srcff; >
=>ff? A
srcffB E
.ffE F
NearbyPlaceffF Q
.ffQ R
IdffR T
)ffT U
)ffU V
;ffV W
	CreateMaphh 
<hh 
Governoratehh 
,hh  
GovernorateDetailDtohh 3
>hh3 4
(hh4 5
)hh5 6
;hh6 7
	CreateMapkk 
<kk 
Propertykk 
,kk 
ExploreHomesDtokk +
>kk+ ,
(kk, -
)kk- .
.ll 
	ForMemberll 
(ll 
destll 
=>ll 
destll "
.ll" #
	MainImagell# ,
,ll, -
optll. 1
=>ll2 4
optll5 8
.ll8 9
MapFromll9 @
(ll@ A
srcllA D
=>llE G
srcllH K
.llK L
	MainImagellL U
)llU V
)llV W
.mm 
	ForMembermm 
(mm 
destmm 
=>mm 
destmm "
.mm" #
Governoratemm# .
,mm. /
optmm0 3
=>mm4 6
optmm7 :
.mm: ;
MapFrommm; B
(mmB C
srcmmC F
=>mmG I
srcmmJ M
.mmM N
GovernoratemmN Y
.mmY Z
NamemmZ ^
)mm^ _
)mm_ `
.nn 
	ForMembernn 
(nn 
destnn 
=>nn 
destnn "
.nn" #
Idnn# %
,nn% &
optnn' *
=>nn+ -
optnn. 1
.nn1 2
MapFromnn2 9
(nn9 :
srcnn: =
=>nn> @
srcnnA D
.nnD E
IdnnE G
)nnG H
)nnH I
;nnI J
}pp 
}qq ƒ
|D:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PropertyGalleryContainer.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
{		 
[

 
BlobContainerName

 
(

 
$str

 (
)

( )
]

) *
public 

class $
PropertyGalleryContainer )
{ 
} 
} ∑+
éD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PropertyFeatures\PropertyFeatureAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
PropertyFeatures  0
{ 
public 

class %
PropertyFeatureAppService *
:+ ,
ApplicationService- ?
,? @&
IPropertyFeatureAppServiceA [
{ 
private 
readonly 
IRepository $
<$ %
Feature% ,
,, -
Guid. 2
>2 3
_repository4 ?
;? @
public %
PropertyFeatureAppService (
(( )
IRepository) 4
<4 5
Feature5 <
,< =
Guid> B
>B C

repositoryD N
)N O
{ 	
_repository 
= 

repository $
;$ %
} 	
public 
async 
Task 
< 
List 
< 
PropertyFeatureDto 1
>1 2
>2 3
GetListAsync4 @
(@ A
)A B
{ 	
var 
propertyFeatures  
=! "
await# (
_repository) 4
.4 5
GetListAsync5 A
(A B
)B C
;C D
return 
ObjectMapper 
.  
Map  #
<# $
List$ (
<( )
Feature) 0
>0 1
,1 2
List3 7
<7 8
PropertyFeatureDto8 J
>J K
>K L
(L M
propertyFeatures  
) 
; 
} 	
public   
async   
Task   
<   
PropertyFeatureDto   ,
>  , -
GetAsync  . 6
(  6 7
Guid  7 ;
id  < >
)  > ?
{!! 	
var"" 
propertyFeature"" 
=""  !
await""" '
_repository""( 3
.""3 4
GetAsync""4 <
(""< =
id""= ?
)""? @
;""@ A
return## 
ObjectMapper## 
.##  
Map##  #
<### $
Feature##$ +
,##+ ,
PropertyFeatureDto##- ?
>##? @
(##@ A
propertyFeature##A P
)##P Q
;##Q R
}$$ 	
public&& 
async&& 
Task&& 
<&& 
PropertyFeatureDto&& ,
>&&, -
CreateAsync&&. 9
(&&9 :+
CreateUpdatePropertyFeaturesDto&&: Y
input&&Z _
)&&_ `
{'' 	
var(( 
propertyFeature(( 
=((  !
new((" %
Feature((& -
{)) 
Name** 
=** 
input** 
.** 
Name** !
,**! "
IconUrl++ 
=++ 
input++ 
.++  
IconUrl++  '
,++' (
},, 
;,, 
await-- 
_repository-- 
.-- 
InsertAsync-- )
(--) *
propertyFeature--* 9
)--9 :
;--: ;
return.. 
ObjectMapper.. 
...  
Map..  #
<..# $
Feature..$ +
,..+ ,
PropertyFeatureDto..- ?
>..? @
(..@ A
propertyFeature..A P
)..P Q
;..Q R
}// 	
public11 
async11 
Task11 
<11 
PropertyFeatureDto11 ,
>11, -
UpdateAsync11. 9
(119 :
Guid22 
id22 
,22 +
CreateUpdatePropertyFeaturesDto33 +
input33, 1
)44 	
{55 	
var66 
propertyFeature66 
=66  !
await66" '
_repository66( 3
.663 4
GetAsync664 <
(66< =
id66= ?
)66? @
;66@ A
propertyFeature77 
.77 
Name77  
=77! "
input77# (
.77( )
Name77) -
;77- .
propertyFeature88 
.88 
IconUrl88 #
=88$ %
input88& +
.88+ ,
IconUrl88, 3
;883 4
await99 
_repository99 
.99 
UpdateAsync99 )
(99) *
propertyFeature99* 9
)999 :
;99: ;
return:: 
ObjectMapper:: 
.::  
Map::  #
<::# $
Feature::$ +
,::+ ,
PropertyFeatureDto::- ?
>::? @
(::@ A
propertyFeature::A P
)::P Q
;::Q R
};; 	
public== 
async== 
Task== 
DeleteAsync== %
(==% &
Guid==& *
id==+ -
)==- .
{>> 	
var?? 
propertyFeature?? 
=??  !
await??" '
_repository??( 3
.??3 4
GetAsync??4 <
(??< =
id??= ?
)??? @
;??@ A
if@@ 
(@@ 
propertyFeature@@ 
==@@  "
null@@# '
)@@' (
{AA 
throwBB 
newBB 
	ExceptionBB #
(BB# $
$strBB$ @
)BB@ A
;BBA B
}CC 
awaitDD 
_repositoryDD 
.DD 
DeleteAsyncDD )
(DD) *
propertyFeatureDD* 9
)DD9 :
;DD: ;
}EE 	
}FF 
}GG ¿Á
ÉD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PropertyData\PropertyAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
PropertyData  ,
;, -
public 
class 
PropertyAppService 
(  
IRepository 
< 
Property 
, 
Guid 
> 

repository  *
,* +
IBlobContainer 
< $
PropertyGalleryContainer +
>+ ,
blobContainer- :
,: ;
IRepository 
< 
PropertyImage 
, 
Guid #
># $#
propertyImageRepository% <
,< =
IRepository 
< 
PropertyVideo 
, 
Guid #
># $#
propertyVideoRepository% <
,< =
IRepository 
< 
Amenity 
, 
Guid 
> %
propertyAmenityRepository 8
,8 9
IRepository   
<   
AccountUser   
,   
Guid   !
>  ! "!
accountUserRepository  # 8
,  8 9
IRepository!! 
<!! 
Governorate!! 
,!! 
Guid!! !
>!!! "!
governorateRepository!!# 8
,!!8 9
IRepository"" 
<"" 
PropertyType"" 
,"" 
Guid"" "
>""" #"
propertyTypeRepository""$ :
,"": ;
IRepository## 
<## 
Feature## 
,## 
Guid## 
>## &
propertyFeaturesRepository## 9
,##9 :
IRepository$$ 
<$$ 
NearbyPlace$$ 
,$$ 
Guid$$ !
>$$! "*
propertyNearbyPlacesRepository$$# A
,$$A B 
IHttpContextAccessor%% 
httpContextAccessor%% ,
)'' 
:(( 
ApplicationService(( 
,(( 
IPropertyAppService(( -
,((- . 
ITransientDependency((/ C
{)) 
private** 
readonly** 
IRepository**  
<**  !
PropertyVideo**! .
,**. /
Guid**0 4
>**4 5#
_propertViedoRepository**6 M
=**N O#
propertyVideoRepository**P g
;**g h
public,, 

async,, 
Task,, 
<,, 
ListResultDto,, #
<,,# $
PropertyDto,,$ /
>,,/ 0
>,,0 1
GetListAsync,,2 >
(,,> ?
PropertyFilterDto-- 
?-- 
	filterDto-- $
=--% &
null--' +
,--+ ,
string.. 
?.. 
sortBy.. 
=.. 
null.. 
,.. 
bool// 
sortDescending// 
=// 
false// #
,//# $
int00 
?00 

maxResults00 
=00 
$num00 
)11 
{22 
var44 
	queryable44 
=44 
(44 
await44 

repository44 )
.44) *
GetQueryableAsync44* ;
(44; <
)44< =
)44= >
.44> ?
AsQueryable44? J
(44J K
)44K L
;44L M
if77 

(77 
	filterDto77 
!=77 
null77 
)77 
{88 	
if99 
(99 
!99 
string99 
.99 
IsNullOrWhiteSpace99 *
(99* +
	filterDto99+ 4
.994 5
AddressKeyword995 C
)99C D
)99D E
{:: 
	queryable;; 
=;; 
	queryable;; %
.;;% &
Where;;& +
(;;+ ,
p;;, -
=>;;. 0
p;;1 2
.;;2 3
Address;;3 :
.;;: ;
Contains;;; C
(;;C D
	filterDto;;D M
.;;M N
AddressKeyword;;N \
);;\ ]
);;] ^
;;;^ _
}<< 
if?? 
(?? 
	filterDto?? 
.?? 
Rooms?? 
.??  
HasValue??  (
&&??) +
	filterDto??, 5
.??5 6
Rooms??6 ;
.??; <
Value??< A
>??B C
$num??D E
)??E F
{@@ 
	queryableAA 
=AA 
	queryableAA %
.AA% &
WhereAA& +
(AA+ ,
pAA, -
=>AA. 0
pAA1 2
.AA2 3
RoomsAA3 8
==AA9 ;
	filterDtoAA< E
.AAE F
RoomsAAF K
.AAK L
ValueAAL Q
)AAQ R
;AAR S
}BB 
ifDD 
(DD 
	filterDtoDD 
.DD 
MinPriceDD "
.DD" #
HasValueDD# +
)DD+ ,
	queryableEE 
=EE 
	queryableEE %
.EE% &
WhereEE& +
(EE+ ,
pEE, -
=>EE. 0
pEE1 2
.EE2 3
PriceEE3 8
>=EE9 ;
	filterDtoEE< E
.EEE F
MinPriceEEF N
.EEN O
ValueEEO T
)EET U
;EEU V
ifGG 
(GG 
	filterDtoGG 
.GG 
MaxPriceGG "
.GG" #
HasValueGG# +
)GG+ ,
	queryableHH 
=HH 
	queryableHH %
.HH% &
WhereHH& +
(HH+ ,
pHH, -
=>HH. 0
pHH1 2
.HH2 3
PriceHH3 8
<=HH9 ;
	filterDtoHH< E
.HHE F
MaxPriceHHF N
.HHN O
ValueHHO T
)HHT U
;HHU V
}JJ 	
ifMM 

(MM 

maxResultsMM 
.MM 
HasValueMM 
&&MM  "

maxResultsMM# -
>MM. /
$numMM0 1
)MM1 2
{NN 	
	queryableOO 
=OO 
	queryableOO !
.OO! "
TakeOO" &
(OO& '

maxResultsOO' 1
.OO1 2
ValueOO2 7
)OO7 8
;OO8 9
}PP 	
	queryableSS 
=SS 
(SS 
stringSS 
.SS 
IsNullOrEmptySS )
(SS) *
sortBySS* 0
)SS0 1
?SS2 3
$strSS4 ;
:SS< =
sortBySS> D
.SSD E
ToLowerSSE L
(SSL M
)SSM N
)SSN O
switchSSP V
{TT 	
$strUU 
=>UU 
sortDescendingUU %
?VV 
	queryableVV 
.VV 
OrderByDescendingVV -
(VV- .
pVV. /
=>VV0 2
pVV3 4
.VV4 5
PriceVV5 :
)VV: ;
:WW 
	queryableWW 
.WW 
OrderByWW #
(WW# $
pWW$ %
=>WW& (
pWW) *
.WW* +
PriceWW+ 0
)WW0 1
,WW1 2
$strYY 
=>YY 
sortDescendingYY '
?ZZ 
	queryableZZ 
.ZZ 
OrderByDescendingZZ -
(ZZ- .
pZZ. /
=>ZZ0 2
pZZ3 4
.ZZ4 5
AddressZZ5 <
)ZZ< =
:[[ 
	queryable[[ 
.[[ 
OrderBy[[ #
([[# $
p[[$ %
=>[[& (
p[[) *
.[[* +
Address[[+ 2
)[[2 3
,[[3 4
_]] 
=>]] 
	queryable]] 
.]] 
OrderBy]] "
(]]" #
p]]# $
=>]]% '
p]]( )
.]]) *
Price]]* /
)]]/ 0
,]]0 1
}^^ 	
;^^	 

varaa 

propertiesaa 
=aa 
awaitaa 
AsyncExecuteraa ,
.aa, -
ToListAsyncaa- 8
(aa8 9
	queryableaa9 B
)aaB C
;aaC D
returnbb 
newbb 
ListResultDtobb  
<bb  !
PropertyDtobb! ,
>bb, -
(bb- .
ObjectMappercc 
.cc 
Mapcc 
<cc 
Listcc !
<cc! "
Propertycc" *
>cc* +
,cc+ ,
Listcc- 1
<cc1 2
PropertyDtocc2 =
>cc= >
>cc> ?
(cc? @

propertiescc@ J
)ccJ K
)dd 	
;dd	 

}ee 
publicgg 

asyncgg 
Taskgg 
<gg 
PropertyDtogg !
>gg! "
GetAsyncgg# +
(gg+ ,
Guidgg, 0
idgg1 3
)gg3 4
{hh 
varii 
propertyii 
=ii 
awaitii 

repositoryii '
.ii' (
GetAsyncii( 0
(ii0 1
idii1 3
)ii3 4
;ii4 5
returnjj 
ObjectMapperjj 
.jj 
Mapjj 
<jj  
Propertyjj  (
,jj( )
PropertyDtojj* 5
>jj5 6
(jj6 7
propertyjj7 ?
)jj? @
;jj@ A
}kk 
publicmm 

asyncmm 
Taskmm 
<mm 
GeneralResponsemm %
>mm% &
CreateAsyncmm' 2
(mm2 3
[mm3 4
FromFormmm4 <
]mm< =#
CreateUpdatePropertyDtomm> U
inputmmV [
)mm[ \
{nn 
tryoo 
{pp 	
awaitqq !
ValidateRelationshipsqq '
(qq' (
inputqq( -
)qq- .
;qq. /
varss 
propertyss 
=ss 
newss 
Propertyss '
{tt 
Titleuu 
=uu 
inputuu 
.uu 
Titleuu #
,uu# $
Descriptionvv 
=vv 
inputvv #
.vv# $
Descriptionvv$ /
,vv/ 0
Priceww 
=ww 
inputww 
.ww 
Priceww #
,ww# $
PaymentTypexx 
=xx 
inputxx #
.xx# $
PaymentTypexx$ /
,xx/ 0
Areayy 
=yy 
inputyy 
.yy 
Areayy !
,yy! "
Roomszz 
=zz 
inputzz 
.zz 
Roomszz #
,zz# $
Latitude{{ 
={{ 
input{{  
.{{  !
Latitude{{! )
,{{) *
	Longitude|| 
=|| 
input|| !
.||! "
	Longitude||" +
,||+ ,
InsurancePayment}}  
=}}! "
input}}# (
.}}( )
InsurancePayment}}) 9
,}}9 :
PropertyTypeId~~ 
=~~  
input~~! &
.~~& '
PropertyTypeId~~' 5
,~~5 6
OwnerId 
= 
input 
.  
OwnerId  '
,' (
GovernorateId
ÅÅ 
=
ÅÅ 
input
ÅÅ  %
.
ÅÅ% &
GovernorateId
ÅÅ& 3
,
ÅÅ3 4
}
ÇÇ 
;
ÇÇ 
var
ÑÑ 
uploadsPath
ÑÑ 
=
ÑÑ 
Path
ÑÑ "
.
ÑÑ" #
Combine
ÑÑ# *
(
ÑÑ* +
	Directory
ÑÑ+ 4
.
ÑÑ4 5!
GetCurrentDirectory
ÑÑ5 H
(
ÑÑH I
)
ÑÑI J
,
ÑÑJ K
$str
ÑÑL U
,
ÑÑU V
$str
ÑÑW `
)
ÑÑ` a
;
ÑÑa b
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
	Directory
ÜÜ 
.
ÜÜ 
Exists
ÜÜ !
(
ÜÜ! "
uploadsPath
ÜÜ" -
)
ÜÜ- .
)
ÜÜ. /
	Directory
áá 
.
áá 
CreateDirectory
áá )
(
áá) *
uploadsPath
áá* 5
)
áá5 6
;
áá6 7
var
ââ 
request
ââ 
=
ââ !
httpContextAccessor
ââ -
.
ââ- .
HttpContext
ââ. 9
?
ââ9 :
.
ââ: ;
Request
ââ; B
;
ââB C
var
ää 
baseUrl
ää 
=
ää 
$"
ää 
{
ää 
request
ää $
?
ää$ %
.
ää% &
Scheme
ää& ,
}
ää, -
$str
ää- 0
{
ää0 1
request
ää1 8
?
ää8 9
.
ää9 :
Host
ää: >
}
ää> ?
"
ää? @
;
ää@ A
var
åå 
	mainImage
åå 
=
åå 
input
åå !
.
åå! "
	MainImage
åå" +
;
åå+ ,
var
éé 
mainFileName
éé 
=
éé 
Path
éé #
.
éé# $
GetFileName
éé$ /
(
éé/ 0
input
éé0 5
.
éé5 6
	MainImage
éé6 ?
.
éé? @
FileName
éé@ H
)
ééH I
;
ééI J
var
èè  
mainUniqueFileName
èè "
=
èè# $
$"
èè% '
{
èè' (
Guid
èè( ,
.
èè, -
NewGuid
èè- 4
(
èè4 5
)
èè5 6
}
èè6 7
$str
èè7 8
{
èè8 9
mainFileName
èè9 E
}
èèE F
"
èèF G
;
èèG H
var
êê 
mainFilePath
êê 
=
êê 
Path
êê #
.
êê# $
Combine
êê$ +
(
êê+ ,
uploadsPath
êê, 7
,
êê7 8 
mainUniqueFileName
êê9 K
)
êêK L
;
êêL M
var
íí 

mainStream
íí 
=
íí 
new
íí  

FileStream
íí! +
(
íí+ ,
mainFilePath
íí, 8
,
íí8 9
FileMode
íí: B
.
ííB C
Create
ííC I
)
ííI J
;
ííJ K
{
ìì 
await
îî 
	mainImage
îî 
.
îî  
CopyToAsync
îî  +
(
îî+ ,

mainStream
îî, 6
)
îî6 7
;
îî7 8
}
ïï 
var
óó 
mainImageFullUrl
óó  
=
óó! "
$"
óó# %
{
óó% &
baseUrl
óó& -
}
óó- .
$str
óó. 7
{
óó7 8 
mainUniqueFileName
óó8 J
}
óóJ K
"
óóK L
;
óóL M
property
òò 
.
òò 
	MainImage
òò 
=
òò  
mainImageFullUrl
òò! 1
;
òò1 2
var
õõ 
images
õõ 
=
õõ 
input
õõ 
.
õõ 
	PhotoUrls
õõ (
;
õõ( )
var
úú 
video
úú 
=
úú 
input
úú 
.
úú 
VideoUrl
úú &
;
úú& '
await
üü 

repository
üü 
.
üü 
InsertAsync
üü (
(
üü( )
property
üü) 1
,
üü1 2
autoSave
üü3 ;
:
üü; <
true
üü= A
)
üüA B
;
üüB C
try
££ 
{
§§ 
if
¶¶ 
(
¶¶ 
images
¶¶ 
?
¶¶ 
.
¶¶ 
Count
¶¶ !
>
¶¶" #
$num
¶¶$ %
)
¶¶% &
{
ßß 
foreach
©© 
(
©© 
var
©©  
image
©©! &
in
©©' )
images
©©* 0
)
©©0 1
{
™™ 
var
´´ 
fileName
´´ $
=
´´% &
Path
´´' +
.
´´+ ,
GetFileName
´´, 7
(
´´7 8
image
´´8 =
.
´´= >
FileName
´´> F
)
´´F G
;
´´G H
var
¨¨ 
uniqueFileName
¨¨ *
=
¨¨+ ,
$"
¨¨- /
{
¨¨/ 0
Guid
¨¨0 4
.
¨¨4 5
NewGuid
¨¨5 <
(
¨¨< =
)
¨¨= >
}
¨¨> ?
$str
¨¨? @
{
¨¨@ A
fileName
¨¨A I
}
¨¨I J
"
¨¨J K
;
¨¨K L
var
≠≠ 
filePath
≠≠ $
=
≠≠% &
Path
≠≠' +
.
≠≠+ ,
Combine
≠≠, 3
(
≠≠3 4
uploadsPath
≠≠4 ?
,
≠≠? @
uniqueFileName
≠≠A O
)
≠≠O P
;
≠≠P Q
await
ØØ 
using
ØØ #
(
ØØ$ %
var
ØØ% (
stream
ØØ) /
=
ØØ0 1
new
ØØ2 5

FileStream
ØØ6 @
(
ØØ@ A
filePath
ØØA I
,
ØØI J
FileMode
ØØK S
.
ØØS T
Create
ØØT Z
)
ØØZ [
)
ØØ[ \
{
∞∞ 
await
±± !
image
±±" '
.
±±' (
CopyToAsync
±±( 3
(
±±3 4
stream
±±4 :
)
±±: ;
;
±±; <
}
≤≤ 
var
¥¥ 
fullUrl
¥¥ #
=
¥¥$ %
$"
¥¥& (
{
¥¥( )
baseUrl
¥¥) 0
}
¥¥0 1
$str
¥¥1 :
{
¥¥: ;
uniqueFileName
¥¥; I
}
¥¥I J
"
¥¥J K
;
¥¥K L
var
∂∂ 
propertyImage
∂∂ )
=
∂∂* +
new
∂∂, /
PropertyImage
∂∂0 =
{
∑∑ 
Url
∏∏ 
=
∏∏  !
fullUrl
∏∏" )
,
∏∏) *
	MediaType
ππ %
=
ππ& '
MediaTypeEnum
ππ( 5
.
ππ5 6
Image
ππ6 ;
,
ππ; <

PropertyId
∫∫ &
=
∫∫' (
property
∫∫) 1
.
∫∫1 2
Id
∫∫2 4
,
∫∫4 5
}
ªª 
;
ªª 
await
ºº %
propertyImageRepository
ºº 5
.
ºº5 6
InsertAsync
ºº6 A
(
ººA B
propertyImage
ººB O
)
ººO P
;
ººP Q
}
ΩΩ 
}
ææ 
if
¡¡ 
(
¡¡ 
video
¡¡ 
!=
¡¡ 
null
¡¡ !
)
¡¡! "
{
¬¬ 
var
√√ 
fileName
√√  
=
√√! "
Path
√√# '
.
√√' (
GetFileName
√√( 3
(
√√3 4
video
√√4 9
.
√√9 :
FileName
√√: B
)
√√B C
;
√√C D
var
ƒƒ 
uniqueFileName
ƒƒ &
=
ƒƒ' (
$"
ƒƒ) +
{
ƒƒ+ ,
Guid
ƒƒ, 0
.
ƒƒ0 1
NewGuid
ƒƒ1 8
(
ƒƒ8 9
)
ƒƒ9 :
}
ƒƒ: ;
$str
ƒƒ; <
{
ƒƒ< =
fileName
ƒƒ= E
}
ƒƒE F
"
ƒƒF G
;
ƒƒG H
var
≈≈ 
filePath
≈≈  
=
≈≈! "
Path
≈≈# '
.
≈≈' (
Combine
≈≈( /
(
≈≈/ 0
uploadsPath
≈≈0 ;
,
≈≈; <
uniqueFileName
≈≈= K
)
≈≈K L
;
≈≈L M
await
«« 
using
«« 
(
««  !
var
««! $
stream
««% +
=
««, -
new
««. 1

FileStream
««2 <
(
««< =
filePath
««= E
,
««E F
FileMode
««G O
.
««O P
Create
««P V
)
««V W
)
««W X
{
»» 
await
…… 
video
…… #
.
……# $
CopyToAsync
……$ /
(
……/ 0
stream
……0 6
)
……6 7
;
……7 8
}
   
var
ÃÃ 
fullUrl
ÃÃ 
=
ÃÃ  !
$"
ÃÃ" $
{
ÃÃ$ %
baseUrl
ÃÃ% ,
}
ÃÃ, -
$str
ÃÃ- =
{
ÃÃ= >
uniqueFileName
ÃÃ> L
}
ÃÃL M
"
ÃÃM N
;
ÃÃN O
var
ŒŒ 
propertyVideo
ŒŒ %
=
ŒŒ& '
new
ŒŒ( +
PropertyVideo
ŒŒ, 9
{
œœ 

PropertyId
–– "
=
––# $
property
––% -
.
––- .
Id
––. 0
,
––0 1
Url
—— 
=
—— 
fullUrl
—— %
}
““ 
;
““ 
property
‘‘ 
.
‘‘ 
PropertyVideo
‘‘ *
=
‘‘+ ,
propertyVideo
‘‘- :
;
‘‘: ;
await
’’ 

repository
’’ $
.
’’$ %
UpdateAsync
’’% 0
(
’’0 1
property
’’1 9
)
’’9 :
;
’’: ;
}
÷÷ 
if
ŸŸ 
(
ŸŸ 
input
ŸŸ 
.
ŸŸ 
	Amenities
ŸŸ #
?
ŸŸ# $
.
ŸŸ$ %
Count
ŸŸ% *
>
ŸŸ+ ,
$num
ŸŸ- .
)
ŸŸ. /
{
⁄⁄ 
var
€€ 
amenityGuids
€€ $
=
€€% &
input
€€' ,
.
€€, -
	Amenities
€€- 6
.
€€6 7
Select
€€7 =
(
€€= >
Guid
€€> B
.
€€B C
Parse
€€C H
)
€€H I
.
€€I J
ToList
€€J P
(
€€P Q
)
€€Q R
;
€€R S
var
‹‹ 
	amenities
‹‹ !
=
‹‹" #
await
‹‹$ )'
propertyAmenityRepository
‹‹* C
.
‹‹C D
GetListAsync
‹‹D P
(
‹‹P Q
a
›› 
=>
›› 
amenityGuids
›› )
.
››) *
Contains
››* 2
(
››2 3
a
››3 4
.
››4 5
Id
››5 7
)
››7 8
)
››8 9
;
››9 :
property
ﬂﬂ 
.
ﬂﬂ 
PropertyAmenities
ﬂﬂ .
=
ﬂﬂ/ 0
	amenities
ﬂﬂ1 :
.
ﬂﬂ: ;
Select
ﬂﬂ; A
(
ﬂﬂA B
a
ﬂﬂB C
=>
ﬂﬂD F
new
ﬂﬂG J
PropertyAmenity
ﬂﬂK Z
{
‡‡ 
	AmenityId
·· !
=
··" #
a
··$ %
.
··% &
Id
··& (
}
‚‚ 
)
‚‚ 
.
‚‚ 
ToList
‚‚ 
(
‚‚ 
)
‚‚ 
;
‚‚  
}
„„ 
if
ÁÁ 
(
ÁÁ 
input
ÁÁ 
.
ÁÁ 
Features
ÁÁ "
?
ÁÁ" #
.
ÁÁ# $
Count
ÁÁ$ )
>
ÁÁ* +
$num
ÁÁ, -
)
ÁÁ- .
{
ËË 
var
ÈÈ 
featureGuids
ÈÈ $
=
ÈÈ% &
input
ÈÈ' ,
.
ÈÈ, -
Features
ÈÈ- 5
.
ÈÈ5 6
Select
ÈÈ6 <
(
ÈÈ< =
Guid
ÈÈ= A
.
ÈÈA B
Parse
ÈÈB G
)
ÈÈG H
.
ÈÈH I
ToList
ÈÈI O
(
ÈÈO P
)
ÈÈP Q
;
ÈÈQ R
var
ÍÍ 
features
ÍÍ  
=
ÍÍ! "
await
ÍÍ# ((
propertyFeaturesRepository
ÍÍ) C
.
ÍÍC D
GetListAsync
ÍÍD P
(
ÍÍP Q
a
ÎÎ 
=>
ÎÎ 
featureGuids
ÎÎ )
.
ÎÎ) *
Contains
ÎÎ* 2
(
ÎÎ2 3
a
ÎÎ3 4
.
ÎÎ4 5
Id
ÎÎ5 7
)
ÎÎ7 8
)
ÎÎ8 9
;
ÎÎ9 :
property
ÌÌ 
.
ÌÌ 
PropertyFeatures
ÌÌ -
=
ÌÌ. /
[
ÌÌ0 1
..
ÌÌ1 3
features
ÌÌ4 <
.
ÌÌ< =
Select
ÌÌ= C
(
ÌÌC D
a
ÌÌD E
=>
ÌÌE G
new
ÌÌG J
PropertyFeature
ÌÌK Z
{
ÓÓ 
	FeatureId
ÔÔ !
=
ÔÔ" #
a
ÔÔ$ %
.
ÔÔ% &
Id
ÔÔ& (
}
 
)
 
]
 
;
 
}
ÒÒ 
if
ıı 
(
ıı 
input
ıı 
.
ıı 
NearbyPlaces
ıı &
?
ıı& '
.
ıı' (
Count
ıı( -
>
ıı. /
$num
ıı0 1
)
ıı1 2
{
ˆˆ 
var
˜˜ 
nearbyGuids
˜˜ #
=
˜˜$ %
input
˜˜& +
.
˜˜+ ,
NearbyPlaces
˜˜, 8
.
˜˜8 9
Select
˜˜9 ?
(
˜˜? @
Guid
˜˜@ D
.
˜˜D E
Parse
˜˜E J
)
˜˜J K
.
˜˜K L
ToList
˜˜L R
(
˜˜R S
)
˜˜S T
;
˜˜T U
var
¯¯ 
places
¯¯ 
=
¯¯  
await
¯¯! &,
propertyNearbyPlacesRepository
¯¯' E
.
¯¯E F
GetListAsync
¯¯F R
(
¯¯R S
a
˘˘ 
=>
˘˘ 
nearbyGuids
˘˘ (
.
˘˘( )
Contains
˘˘) 1
(
˘˘1 2
a
˘˘2 3
.
˘˘3 4
Id
˘˘4 6
)
˘˘6 7
)
˘˘7 8
;
˘˘8 9
property
˚˚ 
.
˚˚ "
PropertyNearbyPlaces
˚˚ 1
=
˚˚2 3
[
˚˚4 5
..
˚˚5 7
places
˚˚8 >
.
˚˚> ?
Select
˚˚? E
(
˚˚E F
a
˚˚F G
=>
˚˚G I
new
˚˚I L!
PropertyNearbyPlace
˚˚M `
{
¸¸ 
NearbyPlaceId
˝˝ %
=
˝˝& '
a
˝˝( )
.
˝˝) *
Id
˝˝* ,
}
˛˛ 
)
˛˛ 
]
˛˛ 
;
˛˛ 
}
ˇˇ 
}
ÄÄ 
catch
ÅÅ 
(
ÅÅ 
	Exception
ÅÅ 
e
ÅÅ 
)
ÅÅ 
{
ÇÇ 
Console
ÉÉ 
.
ÉÉ 
	WriteLine
ÉÉ !
(
ÉÉ! "
e
ÉÉ" #
)
ÉÉ# $
;
ÉÉ$ %
throw
ÑÑ 
;
ÑÑ 
}
ÖÖ 
var
àà 
result
àà 
=
àà 
ObjectMapper
àà %
.
àà% &
Map
àà& )
<
àà) *
Property
àà* 2
,
àà2 3
PropertyDetailDto
àà4 E
>
ààE F
(
ààF G
property
ààG O
)
ààO P
;
ààP Q
return
ââ 
new
ââ 
GeneralResponse
ââ &
(
ââ& '
true
ââ' +
,
ââ+ ,
$str
ââ- O
,
ââO P
result
ââQ W
)
ââW X
;
ââX Y
}
ää 	
catch
ãã 
(
ãã 
	Exception
ãã 
e
ãã 
)
ãã 
{
åå 	
return
éé 
new
éé 
GeneralResponse
éé &
(
éé& '
false
éé' ,
,
éé, -
e
éé. /
.
éé/ 0
Message
éé0 7
,
éé7 8
e
éé9 :
.
éé: ;

StackTrace
éé; E
)
ééE F
;
ééF G
}
èè 	
}
íí 
public
îî 

async
îî 
Task
îî 
<
îî 
PropertyDto
îî !
>
îî! "
UpdateAsync
îî# .
(
îî. /
Guid
îî/ 3
id
îî4 6
,
îî6 7%
CreateUpdatePropertyDto
îî8 O
input
îîP U
)
îîU V
{
ïï 
var
ññ 
property
ññ 
=
ññ 
await
ññ 

repository
ññ '
.
ññ' (
GetAsync
ññ( 0
(
ññ0 1
id
ññ1 3
)
ññ3 4
;
ññ4 5
ObjectMapper
óó 
.
óó 
Map
óó 
(
óó 
input
óó 
,
óó 
property
óó  (
)
óó( )
;
óó) *
await
òò 

repository
òò 
.
òò 
UpdateAsync
òò $
(
òò$ %
property
òò% -
)
òò- .
;
òò. /
return
ôô 
ObjectMapper
ôô 
.
ôô 
Map
ôô 
<
ôô  
Property
ôô  (
,
ôô( )
PropertyDto
ôô* 5
>
ôô5 6
(
ôô6 7
property
ôô7 ?
)
ôô? @
;
ôô@ A
}
öö 
public
úú 

async
úú 
Task
úú 
DeleteAsync
úú !
(
úú! "
Guid
úú" &
id
úú' )
)
úú) *
{
ùù 
await
ûû 

repository
ûû 
.
ûû 
DeleteAsync
ûû $
(
ûû$ %
id
ûû% '
)
ûû' (
;
ûû( )
}
üü 
public
°° 

async
°° 
Task
°° 
<
°° 
Stream
°° 
>
°° 
GetImageAsync
°° +
(
°°+ ,
string
°°, 2
blobName
°°3 ;
)
°°; <
{
¢¢ 
return
££ 
await
££ 
blobContainer
££ "
.
££" #
GetAsync
££# +
(
££+ ,
blobName
££, 4
)
££4 5
;
££5 6
}
§§ 
public
¶¶ 

async
¶¶ 
Task
¶¶ 
<
¶¶ 
Stream
¶¶ 
>
¶¶ 
GetVideoAsync
¶¶ +
(
¶¶+ ,
string
¶¶, 2
blobName
¶¶3 ;
)
¶¶; <
{
ßß 
return
®® 
await
®® 
blobContainer
®® "
.
®®" #
GetAsync
®®# +
(
®®+ ,
blobName
®®, 4
)
®®4 5
;
®®5 6
}
©© 
private
´´ 
async
´´ 
Task
´´ #
ValidateRelationships
´´ ,
(
´´, -%
CreateUpdatePropertyDto
´´- D
input
´´E J
)
´´J K
{
¨¨ 
if
ØØ 

(
ØØ 
!
ØØ 
await
ØØ $
propertyTypeRepository
ØØ )
.
ØØ) *
AnyAsync
ØØ* 2
(
ØØ2 3
x
ØØ3 4
=>
ØØ4 6
x
ØØ6 7
.
ØØ7 8
Id
ØØ8 :
==
ØØ; =
input
ØØ> C
.
ØØC D
PropertyTypeId
ØØD R
)
ØØR S
)
ØØS T
{
∞∞ 	
throw
±± 
new
±± #
UserFriendlyException
±± +
(
±±+ ,
$str
±±, U
)
±±U V
;
±±V W
}
≤≤ 	
if
µµ 

(
µµ 
!
µµ 
await
µµ #
accountUserRepository
µµ (
.
µµ( )
AnyAsync
µµ) 1
(
µµ1 2
x
µµ2 3
=>
µµ3 5
x
µµ5 6
.
µµ6 7
Id
µµ7 9
==
µµ: <
input
µµ= B
.
µµB C
OwnerId
µµC J
)
µµJ K
)
µµK L
{
∂∂ 	
throw
∑∑ 
new
∑∑ #
UserFriendlyException
∑∑ +
(
∑∑+ ,
$str
∑∑, F
)
∑∑F G
;
∑∑G H
}
∏∏ 	
if
∫∫ 

(
∫∫ 
!
∫∫ 
await
∫∫ #
governorateRepository
∫∫ (
.
∫∫( )
AnyAsync
∫∫) 1
(
∫∫1 2
x
∫∫2 3
=>
∫∫3 5
x
∫∫5 6
.
∫∫6 7
Id
∫∫7 9
==
∫∫: <
input
∫∫= B
.
∫∫B C
GovernorateId
∫∫C P
)
∫∫P Q
)
∫∫Q R
{
ªª 	
throw
ºº 
new
ºº #
UserFriendlyException
ºº +
(
ºº+ ,
$str
ºº, L
)
ººL M
;
ººM N
}
ΩΩ 	
}
ÀÀ 
}ÕÕ ƒ#
áD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\PropertyAmenities\AmenityAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
PropertyAmenities  1
{ 
public 

class 
AmenityAppService "
:" #
ApplicationService$ 6
,6 7
IAmenityAppService8 J
{ 
private 
readonly 
IRepository $
<$ %
Amenity% ,
,, -
Guid. 2
>2 3
_repository4 ?
;? @
public 
AmenityAppService  
(  !
IRepository! ,
<, -
Amenity- 4
,4 5
Guid6 :
>: ;

repository< F
)F G
{ 	
_repository 
= 

repository $
;$ %
} 	
public 
async 
Task 
< 

AmenityDto %
>% &
CreateAsync' 2
(2 3"
CreateUpdateAmenityDto3 I
inputJ O
)O P
{ 	
var 
amenity 
= 
ObjectMapper &
.& '
Map' *
<* +"
CreateUpdateAmenityDto+ A
,A B
AmenityC J
>J K
(K L
inputL Q
)Q R
;R S
await 
_repository 
. 
InsertAsync )
() *
amenity* 1
)1 2
;2 3
return 
ObjectMapper 
.  
Map  #
<# $
Amenity$ +
,+ ,

AmenityDto- 7
>7 8
(8 9
amenity9 @
)@ A
;A B
} 	
public!! 
Task!! 
DeleteAsync!! 
(!!  
Guid!!  $
id!!% '
)!!' (
{"" 	
return## 
_repository## 
.## 
DeleteAsync## *
(##* +
id##+ -
)##- .
;##. /
}$$ 	
public&& 
async&& 
Task&& 
<&& 

AmenityDto&& $
>&&$ %
GetAsync&&& .
(&&. /
Guid&&/ 3
id&&4 6
)&&6 7
{'' 	
var(( 
propertyType(( 
=(( 
await(( $
_repository((% 0
.((0 1
GetAsync((1 9
(((9 :
id((: <
)((< =
;((= >
return)) 
ObjectMapper)) 
.))  
Map))  #
<))# $
Amenity))$ +
,))+ ,

AmenityDto))- 7
>))7 8
())8 9
propertyType))9 E
)))E F
;))F G
}** 	
public,, 
async,, 
Task,, 
<,, 
List,, 
<,, 

AmenityDto,, )
>,,) *
>,,* +
GetListAsync,,, 8
(,,8 9
),,9 :
{-- 	
var.. 
	amenities.. 
=.. 
await.. !
_repository.." -
...- .
GetListAsync... :
(..: ;
)..; <
;..< =
return// 
ObjectMapper// 
.//  
Map//  #
<//# $
List//$ (
<//( )
Amenity//) 0
>//0 1
,//1 2
List//3 7
<//7 8

AmenityDto//8 B
>//B C
>//C D
(//D E
	amenities//E N
)//N O
;//O P
}00 	
public22 
async22 
Task22 
<22 

AmenityDto22 $
>22$ %
UpdateAsync22& 1
(221 2
Guid222 6
id227 9
,229 :"
CreateUpdateAmenityDto22; Q
input22R W
)22W X
{33 	
var44 
propertyType44 
=44 
await44 $
_repository44% 0
.440 1
GetAsync441 9
(449 :
id44: <
)44< =
;44= >
ObjectMapper55 
.55 
Map55 
(55 
input55 "
,55" #
propertyType55$ 0
)550 1
;551 2
return66 
ObjectMapper66 
.66  
Map66  #
<66# $
Amenity66$ +
,66+ ,

AmenityDto66- 7
>667 8
(668 9
propertyType669 E
)66E F
;66F G
}77 	
}88 
}:: ó
{D:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 
'
InternalsVisibleToAttribute
 %
(% &
$str& O
)O P
]P QŒ6
áD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\NearbyPlaces\NearbyPlacesAppService.cs
	namespace 	
SawaTech
 
. 
PropertyMini 
.  
NearbyPlaces  ,
{ 
public 

class "
NearbyPlacesAppService '
:( )
ApplicationService* <
,< =#
INearbyPlacesAppService> U
{ 
private 
readonly 
IRepository $
<$ %
NearbyPlace% 0
,0 1
Guid2 6
>6 7
_repository8 C
;C D
public "
NearbyPlacesAppService %
(% &
IRepository& 1
<1 2
NearbyPlace2 =
,= >
Guid? C
>C D

repositoryE O
)O P
{ 	
_repository 
= 

repository $
;$ %
} 	
public 
async 
Task 
< 
GeneralResponse )
>) *"
CreateNearbyPlaceAsync+ A
(A B#
CreateUpdateNearbyPlaceB Y
inputZ _
)_ `
{ 	
var 
nearbyPlace 
= 
ObjectMapper *
.* +
Map+ .
<. /#
CreateUpdateNearbyPlace/ F
,F G
NearbyPlaceH S
>S T
(T U
inputU Z
)Z [
;[ \
await 
_repository 
. 
InsertAsync *
(* +
nearbyPlace+ 6
)6 7
;7 8
return 
new 
GeneralResponse &
(& '
true' +
,+ ,
$str- P
,P Q
nearbyPlaceR ]
)] ^
;^ _
} 	
public   
async   
Task   
<   
GeneralResponse   )
>  ) *"
DeleteNearbyPlaceAsync  + A
(  A B
Guid  B F
id  G I
)  I J
{!! 	
try"" 
{## 
var$$ 
place$$ 
=$$ 
await$$ !
_repository$$" -
.$$- .
GetAsync$$. 6
($$6 7
id$$7 9
)$$9 :
;$$: ;
if%% 
(%% 
place%% 
==%% 
null%% !
)%%! "
{&& 
return'' 
new'' 
GeneralResponse'' .
(''. /
false''/ 4
,''4 5
$str''6 M
,''M N
null''O S
)''S T
;''T U
}(( 
await)) 
_repository)) !
.))! "
DeleteAsync))" -
())- .
place)). 3
)))3 4
;))4 5
return++ 
new++ 
GeneralResponse++ *
(++* +
true+++ /
,++/ 0
$str++1 L
,++L M
null++N R
)++R S
;++S T
},, 
catch-- 
(-- 
	Exception-- 
ex-- 
)--  
{.. 
return// 
new// 
GeneralResponse// *
(//* +
false//+ 0
,//0 1
ex//2 4
.//4 5
Message//5 <
,//< =
ex//> @
.//@ A

StackTrace//A K
)//K L
;//L M
}00 
}44 	
public66 
async66 
Task66 
<66 
GeneralResponse66 )
>66) *
GetNearbyPlaceAsync66+ >
(66> ?
Guid66? C
id66D F
)66F G
{77 	
var88 
place88 
=88 
await88 
_repository88 )
.88) *
GetAsync88* 2
(882 3
id883 5
)885 6
;886 7
var99 
result99 
=99 
ObjectMapper99 %
.99% &
Map99& )
<99) *
NearbyPlace99* 5
,995 6
NearbyPlaceDto997 E
>99E F
(99F G
place99G L
)99L M
;99M N
if:: 
(:: 
result:: 
!=:: 
null:: 
):: 
{;; 
return== 
new== 
GeneralResponse== *
(==* +
true==+ /
,==/ 0
$str==1 :
,==: ;
result==< B
)==B C
;==C D
}>> 
else?? 
{@@ 
returnAA 
newAA 
GeneralResponseAA *
(AA* +
falseAA+ 0
,AA0 1
$strAA2 :
,AA: ;
nullAA< @
)AA@ A
;AAA B
}BB 
}DD 	
publicFF 
asyncFF 
TaskFF 
<FF 
GeneralResponseFF )
>FF) * 
GetNearbyPlacesAsyncFF+ ?
(FF? @
)FF@ A
{GG 	
varHH 
nearbyPlacesHH 
=HH 
awaitHH $
_repositoryHH% 0
.HH0 1
GetListAsyncHH1 =
(HH= >
)HH> ?
;HH? @
varII 
placesII 
=II 
ObjectMapperII $
.II$ %
MapII% (
<II( )
ListII) -
<II- .
NearbyPlaceII. 9
>II9 :
,II: ;
ListII< @
<II@ A
NearbyPlaceDtoIIA O
>IIO P
>IIP Q
(IIQ R
nearbyPlacesJJ 
)KK 
;KK 
returnMM 
newMM 
GeneralResponseMM &
(MM& '
trueMM' +
,MM+ ,
$strMM- 6
,MM6 7
placesMM8 >
)MM> ?
;MM? @
}NN 	
publicPP 
asyncPP 
TaskPP 
<PP 
GeneralResponsePP )
>PP) *"
UpdateNearbyPlaceAsyncPP+ A
(PPA B
GuidPPB F
idPPG I
,PPI J#
CreateUpdateNearbyPlacePPK b
inputPPc h
)PPh i
{QQ 	
varRR 
placeRR 
=RR 
awaitRR 
_repositoryRR )
.RR) *
GetAsyncRR* 2
(RR2 3
idRR3 5
)RR5 6
;RR6 7
placeSS 
.SS 
NameSS 
=SS 
inputSS 
.SS 
NameSS #
;SS# $
awaitTT 
_repositoryTT 
.TT 
UpdateAsyncTT )
(TT) *
placeTT* /
)TT/ 0
;TT0 1
varUU 
updatePlaceUU 
=UU 
ObjectMapperUU *
.UU* +
MapUU+ .
<UU. /
NearbyPlaceUU/ :
,UU: ;
NearbyPlaceDtoUU< J
>UUJ K
(UUK L
placeUUL Q
)UUQ R
;UUR S
returnVV 
newVV 
GeneralResponseVV &
(VV& '
trueVV' +
,VV+ ,
$strVV- H
,VVH I
updatePlaceVVJ U
)VVU V
;VVV W
}WW 	
}XX 
}YY „%
äD:\PROJECTS\.NET\ABP Framework\SawaTech assign\aspnet-core\src\SawaTech.PropertyMini.Application\GovernoratesApp\GovernoratesAppService.cs
	namespace		 	
SawaTech		
 
.		 
PropertyMini		 
.		  
GovernoratesApp		  /
{

 
public 

class "
GovernoratesAppService '
(' (
IRepository( 3
<3 4
Governorate4 ?
,? @
GuidA E
>E F

repositoryG Q
)Q R
: 	
ApplicationService
 
, "
IGovernorateAppService 4
{ 
public 
async 
Task 
< 
GovernorateDto (
>( )
CreateAsync* 5
(5 6&
CreateUpdateGovernorateDto6 P
inputQ V
)V W
{ 	
var 
governorate 
= 
new !
Governorate" -
{ 
Name 
= 
input 
. 
Name !
} 
; 
await 

repository 
. 
InsertAsync (
(( )
governorate) 4
)4 5
;5 6
return 
ObjectMapper 
.  
Map  #
<# $
Governorate$ /
,/ 0
GovernorateDto1 ?
>? @
(@ A
governorateA L
)L M
;M N
} 	
public 
async 
Task 
DeleteAsync %
(% &
Guid& *
id+ -
)- .
{ 	
var 
governorate 
= 
await #

repository$ .
.. /
GetAsync/ 7
(7 8
id8 :
): ;
;; <
if 
( 
governorate 
== 
null #
)# $
{ 
throw 
new 
	Exception #
(# $
$str$ D
)D E
;E F
} 
await 

repository 
. 
DeleteAsync (
(( )
governorate) 4
)4 5
;5 6
}   	
public"" 
async"" 
Task"" 
<"" 
GovernorateDto"" (
>""( )
GetAsync""* 2
(""2 3
Guid""3 7
id""8 :
)"": ;
{## 	
var$$ 
governorate$$ 
=$$ 
await$$ #

repository$$$ .
.$$. /
GetAsync$$/ 7
($$7 8
id$$8 :
)$$: ;
;$$; <
return%% 
ObjectMapper%% 
.%%  
Map%%  #
<%%# $
Governorate%%$ /
,%%/ 0
GovernorateDto%%1 ?
>%%? @
(%%@ A
governorate%%A L
)%%L M
;%%M N
}&& 	
public(( 
async(( 
Task(( 
<(( 
List(( 
<(( 
GovernorateDto(( -
>((- .
>((. /
GetListAsync((0 <
(((< =
)((= >
{)) 	
var** 
governorates** 
=** 
await** $

repository**% /
.**/ 0
GetListAsync**0 <
(**< =
)**= >
;**> ?
return++ 
ObjectMapper++ 
.++  
Map++  #
<++# $
List++$ (
<++( )
Governorate++) 4
>++4 5
,++5 6
List++7 ;
<++; <
GovernorateDto++< J
>++J K
>++K L
(++L M
governorates++M Y
)++Y Z
;++Z [
},, 	
public.. 
async.. 
Task.. 
<.. 
GovernorateDto.. (
>..( )
UpdateAsync..* 5
(..5 6
Guid..6 :
id..; =
,..= >&
CreateUpdateGovernorateDto..? Y
input..Z _
).._ `
{// 	
var00 
governorate00 
=00 
await00 $

repository00% /
.00/ 0
GetAsync000 8
(008 9
id009 ;
)00; <
;00< =
governorate11 
.11 
Name11 
=11 
input11 $
.11$ %
Name11% )
;11) *
await22 

repository22 
.22 
UpdateAsync22 (
(22( )
governorate22) 4
)224 5
;225 6
return33 
ObjectMapper33 
.33  
Map33  #
<33# $
Governorate33$ /
,33/ 0
GovernorateDto331 ?
>33? @
(33@ A
governorate33A L
)33L M
;33M N
}44 	
}55 
}66 